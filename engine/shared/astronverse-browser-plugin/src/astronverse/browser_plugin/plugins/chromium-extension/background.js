var e=Object.defineProperty,__publicField=(t,a,n)=>((t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n)(t,"symbol"!=typeof a?a+"":a,n);const log_info=(...e)=>{console.log("[info]",...e)},log_time=e=>{console.time(e)},log_timeEnd=e=>{console.timeEnd(e)};function gen_short_id(){return"xxxxxxxx".replace(/[x]/g,(function(){return(16*Math.random()|0).toString(16)}))}function gen_time(){return Math.floor((new Date).getTime()/1e3)}function default_log(e){console.info("[info]",e)}class BaseMsg{constructor(e=void 0,t=void 0,a=void 0,n=void 0,r=void 0,i=void 0,s=void 0,c=void 0,o=void 0){this.reply_event_id=e,this.event_id=t,this.event_time=a,this.channel=n,this.key=r,this.uuid=i,this.send_uuid=s,this.need_ack=c,this.data=o}to_reply(){let e=new BaseMsg;return e.reply_event_id=this.event_id,e.channel=this.channel,e.key=this.key,e.uuid=this.send_uuid,e.send_uuid=this.uuid,e.need_ack=this.need_ack,e.data=void 0,e.init()}init(){return this.event_id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),this.event_time=gen_time(),this}tojson(){return JSON.stringify(this)}}class WsException extends Error{}class WatchRetry extends WsException{}class WatchTimeout extends WsException{}const t=new BaseMsg;t.channel="ping";const a=new BaseMsg;a.channel="pong";const n=new BaseMsg;n.channel="exit";const r=new BaseMsg;r.channel="ack";class Route{constructor(e,t,a){this.channel=e,this.key=t,this.func=a}}class Watch{constructor(e,t,a=void 0,n=0){this.watch_type=e,this.watch_key=t,this.callback=a,this.retry_time=n,this.interval=10,this.time=0,this.timeout=0}init(e){return this.interval=e,this.timeout=gen_time()+this.interval,this}retry(){this.time+=1,this.timeout+=this.interval}}class WsApp{constructor(e,t=30,a=10,n=20,r=default_log){this.url=e,this.log=r,this.ws_app=void 0,this.running=!1,this.ping_interval=t,this.routes={},this.reconnect_time=0,this.reconnect_interval=a,this.reconnect_max_time=n,this.watch_interval=1,this.watch_msg={},this.watch_msg_queue=[],this.start_ping_task=void 0}_send_text(e){this.ws_app&&this.ws_app.send(e.tojson())}_call_route(e,t,a){let n=`${e}$$${t}`,r=`${e}$$`;if(n in this.routes){return(0,this.routes[n].func)(a)}if(r in this.routes){return(0,this.routes[r].func)(a)}throw new WsException(`func is not exist: ${e} ${t}`)}_call_watch(e,t,a){null!=e.callback&&e.callback(t,a)}event(e,t,a){let n=`${e}$$${t}`;this.routes[n]=new Route(e,t,a)}_add_watch(e){let t=`${e.watch_type}$$${e.watch_key}`;this.watch_msg[t]=e,this.watch_msg_queue.push({time:e.timeout,name:t}),this.watch_msg_queue.sort(((e,t)=>e.time-t.time))}_clear_watch(){setTimeout((()=>{for(;this.running&&this.watch_msg_queue.length>0;){let t=gen_time();if(this.watch_msg_queue[0].time>t)break;try{let e=this.watch_msg_queue[0].name;if(this.watch_msg_queue.shift(),e in this.watch_msg){let t=this.watch_msg[e];t.retry(),t.time>t.retry_time?(this._call_wait(t,void 0,WatchTimeout("watch timeout")),delete this.watch_msg[e]):(this._call_wait(t,void 0,WatchRetry("retry")),this.watch_msg_queue.push({time:t.timeout,name:e}),this.watch_msg_queue.sort(((e,t)=>e.time-t.time)))}}catch(e){this.log(`error _clear_watch: ${e}`)}}this._clear_watch()}),1e3*this.watch_interval)}_close_watch(){this.watch_msg={},this.watch_msg_queue=[]}_start_ping(){this.start_ping_task=setInterval((()=>{this.running&&(this.log(this.url),this._send_text(t))}),1e3*this.ping_interval)}_close_ping(){clearInterval(this.start_ping_task),this.start_ping_task=void 0}send(e){(()=>{this._send_text(e)})()}send_reply(e,t,a,n=void 0){this._add_watch(new Watch("reply",e.event_id,((e,t)=>{null==t?a(e):n&&n(t)})).init(t)),this.send(e)}_on_message(){let e=this;return function(t){let i=JSON.parse(t.data),s=new BaseMsg(i.reply_event_id,i.event_id,i.event_time,i.channel,i.key,i.uuid,i.send_uuid,i.need_ack,i.data);setTimeout((function(){if(s.channel==a.channel)return;if(s.channel==r.channel){let t=`ack$$${s.event_id}`;if(t in e.watch_msg){let a=e.watch_msg[t];e._call_wait(a,s,void 0),delete e.watch_msg[t]}return}if(s.channel==n.channel)return void e.log(`error ExitMsg: ${s.tojson}`);if(s.reply_event_id){let t=`reply$$${s.reply_event_id}`;if(t in e.watch_msg){let a=e.watch_msg[t];e._call_watch(a,s,void 0),delete e.watch_msg[t]}return}let t=s.to_reply();try{let a=e._call_route(s.channel,s.key,s);t.data=a}catch(i){t.data=String(i)}try{null!=t.data&&e.send(t)}catch(i){e.log(`error _call_route: ${i}`)}}),0)}}_on_open(){let e=this;return function(t){e.running=!0,e._start_ping(),e._clear_watch();try{e._call_route("open","",void 0)}catch(a){e.log(`error _on_open _call_route: ${a}`)}}}_on_close(){let e=this;return function(t){e.running=!1,e._close_ping(),e._close_watch(),e.ws_app=void 0;try{e._call_route("close","",void 0)}catch(a){e.log(`error _on_close _call_route: ${a}`)}e._reconnect()}}_on_error(){let e=this;return function(t){try{e._call_route("error","",void 0)}catch(a){e.log(`error _on_error _call_route: ${a}`)}e.log(`error _on_error:${t}`)}}_reconnect(){setTimeout((()=>{(-1===this.reconnect_max_time||this.reconnect_time<this.reconnect_max_time)&&(this.reconnect_time+=1,this.log(`_reconnect star: ${this.reconnect_time}`),this.start(),this.log(`_reconnect end: ${this.reconnect_time}`))}),1e3*this.reconnect_interval)}start(){let e=this;try{this.ws_app=new WebSocket(this.url),this.ws_app.onopen=this._on_open(),this.ws_app.onmessage=this._on_message(),this.ws_app.onclose=this._on_close(),this.ws_app.onerror=this._on_error()}catch(t){e.log(`error start: ${t}`)}}}const i="$firefox$"===function(){const e=/Chrome/.test(navigator.userAgent),t=/Firefox/.test(navigator.userAgent),a=/Edg/.test(navigator.userAgent);return t?"$firefox$":a?"$edge$":e?"$chrome$":"$unknown$"}()?browser.storage.local:chrome.storage.local;async function createWsApp(){const{cid:e=gen_short_id()}=await i.get("cid");await i.set({cid:e});const t="$chromium$";console.info("[info]",`token: ${t}`);const a=btoa(t),n=function(){const e=navigator.userAgentData;let t="unknown";if(e&&e.brands)for(const a of e.brands)"Chromium"===a.brand&&(t=a.version);return t}();return new WsApp(`ws://127.0.0.1:9082/ws?token=${a}&nv=${n}&cid=${e}`,10,10,-1)}const s=["dibfknoajiboamheempfppeapcedplgm","gfpcfabhkgenjcmjgnldmkhjieekeeea"];chrome.runtime.id;const c=["getElement","contentInject","backgroundInject"];var o=(e=>(e.SUCCESS="0000",e.UNKNOWN_ERROR="5001",e.ELEMENT_NOT_FOUND="5002",e.EXECUTE_ERROR="5003",e.VERSION_ERROR="5004",e))(o||{}),l=(e=>(e.TAB_GET_ERROR="获取标签页失败",e.ACTIVE_TAB_ERROR="未找到活动标签页，请检查是否激活目标窗口",e.NUMBER_ID_ERROR="id 必须是数字",e.FRAME_GET_ERROR="未找到元素对应的iframe",e.CURRENT_TAB_UNSUPPORT_ERROR="当前标签页不支持web拾取协议",e.NOT_SIMILAR_ELEMENT="该元素不是相似元素",e.SIMILAR_NOT_FOUND="未找到相似元素",e.RELATIVE_ELEMENT_PARAMS_ERROR="关联元素参数错误",e.ELEMENT_NOT_FOUND="未找到元素",e.UNSUPPORT_ERROR="暂未实现,请升级到最新版本",e.PARAMS_URL_NOT_FOUND="缺少url字段！",e.PARAMS_NAME_NOT_FOUND="缺少name字段！",e.PARAMS_NAME_VALUE_NOT_FOUND="缺少必填字段name, value！",e.CONTEXT_NOT_FOUND="未找到执行上下文，请确保页面已加载完成",e.EXECUTE_ERROR="执行失败，未获取到结果",e.DEBUGGER_TIMOUT="检测 Debugger 状态超时",e.CONTENT_MESSAGE_ERROR="内容脚本消息响应错误",e))(l||{}),d=(e=>(e.DELETE_SUCCESS="删除成功",e.SET_SUCCESS="设置成功",e.EMPTY_SUCCESS="清空成功",e))(d||{});const u={getNavigatorUserAgent(){const e=/Chrome/.test(navigator.userAgent),t=/Firefox/.test(navigator.userAgent),a=/Edg/.test(navigator.userAgent);return t?"$firefox$":a?"$edge$":e?"$chrome$":"$unknown$"},wait:async e=>new Promise((t=>{setTimeout(t,1e3*e)})),removeUrlParams:e=>e.replace(/\?.*$/,""),isEndWithSlash:e=>e.endsWith?e.endsWith("/"):"/"===e.substr(-1),stringToRegex(e){let t=e,a="";const n=e.lastIndexOf("/");e.startsWith("/")&&n>0&&(t=e.slice(1,n),t.startsWith("^")&&t.endsWith("$")&&(t=t.slice(1,-1)),(t.includes("\\d")||t.includes("\\w")||t.includes("\\s")||t.includes("\\b")||t.includes("\\.")||t.includes("\\*")||t.includes("\\?")||t.includes("\\+")||t.includes("\\{")||t.includes("\\}")||t.includes("\\[")||t.includes("\\]"))&&(t=t.replace(/\\/g,"\\")),a=e.slice(n+1));try{return new RegExp(t,a)}catch{throw new Error("Invalid regular expression pattern")}},isSupportProtocal:e=>!!(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://")||e.startsWith("file://")),isNumberStartString:e=>/^\d/.test(e),isNumberString:e=>/\d/.test(e),isSpecialCharacter(e){return!!this.isNumberStartString(e)||!!/[~`!@#$%^&*()+\-={}\\[\]|:;"'<>,.?/（）￥！、；：“”‘’【】《》，。？]/.test(e)},success:(e,t="success")=>({code:o.SUCCESS,data:e,msg:t}),fail:(e="failed",t=o.UNKNOWN_ERROR)=>({data:null,code:t,msg:e}),result:(e,t="success",a=o.SUCCESS)=>({code:a,data:e,msg:t})},m={getCookie:e=>new Promise((t=>{e.url||t(u.fail(l.PARAMS_URL_NOT_FOUND)),e.path?(e.domain=new URL(e.url).hostname,delete e.url):delete e.path,chrome.cookies.getAll({...e},(e=>{Array.isArray(e)&&e.length?t(u.success(e[0])):t(u.success(null))}))})),removeCookie:e=>new Promise((t=>{e.url||t(u.fail(l.PARAMS_URL_NOT_FOUND)),e.name||t(u.fail(l.PARAMS_NAME_NOT_FOUND)),chrome.cookies.remove(e,(()=>{t(u.success(d.DELETE_SUCCESS))}))})),setCookies:e=>new Promise((t=>{e.url||t(u.fail(l.PARAMS_URL_NOT_FOUND)),e.name&&e.value||t(u.fail(l.PARAMS_NAME_VALUE_NOT_FOUND)),chrome.cookies.set(e,(()=>{t(u.success(d.SET_SUCCESS))}))})),getAllCookies:e=>new Promise((t=>{""!==e.path?(e.domain=new URL(e.url).hostname,delete e.url):delete e.path,chrome.cookies.getAll(e,(e=>{t(u.success(e))}))})),emptyCookies:e=>new Promise((t=>{m.getAllCookies(e).then((e=>{const a=e.data;if(Array.isArray(a)&&a.length){const e=a.map((e=>{const t=`http${e.secure?"s":""}://${e.domain.startsWith(".")?e.domain.slice(1):e.domain}${e.path}`;return m.removeCookie({url:t,name:e.name})}));Promise.all(e).then((()=>{t(u.success(d.EMPTY_SUCCESS))}))}else t(u.success(d.EMPTY_SUCCESS))}))}))};class DataTable{constructor(e,t,a){if(__publicField(this,"data"),__publicField(this,"produceType"),this.produceType=a,"table"===a&&(this.data={...e,produceType:a,values:t}),"similar"===a){const n={...e,value:t};this.data={produceType:a,values:[n]}}}getTable(){return this.data}isSimilarDataType(){return"similar"===this.produceType}}const h="$firefox$"===u.getNavigatorUserAgent(),g={attached:!1,tabId:0,frameContextIdMap:{0:[]},attachDebugger:e=>new Promise(((t,a)=>{if(g.attached)return a(new Error("Debugger is already attached to a tab"));chrome.debugger.attach({tabId:e},"1.3",(()=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),a(chrome.runtime.lastError)):(log_info("Debugger attached successfully"),g.tabId=e,g.attached=!0,t(!0))}))})),enableRuntime:e=>new Promise(((t,a)=>{chrome.debugger.sendCommand({tabId:e},"Runtime.enable",{},(()=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),a(chrome.runtime.lastError)):t(!0)}))})),detachDebugger:e=>new Promise((t=>{chrome.debugger.detach({tabId:e},(()=>{log_info("Debugger detached successfully"),g.attached=!1,g.frameContextIdMap={0:[]},t(!0)}))})),evaluate:async(e,t,a)=>{t=`(function() { ${t} })()`,await g.attachDebugger(e),await g.enableRuntime(e),await u.wait(1);const n=g.frameContextIdMap[a]||[];if(!n.length)throw new Error(l.CONTEXT_NOT_FOUND);const r=null==n?void 0:n.map((a=>chrome.debugger.sendCommand({tabId:e},"Runtime.evaluate",{expression:t,contextId:a}))),i=await Promise.all(r),s=i.find((e=>!e.exceptionDetails)),c=i.find((e=>e.exceptionDetails));if(log_info("evaluate successRes: ",s,"evaluate failRes: ",c),await g.detachDebugger(e),s)return s.result.value||"";throw c?new Error(c.result.description):new Error(l.EXECUTE_ERROR)},getFrameTree:async e=>{await g.attachDebugger(e),await g.enableRuntime(e);const t=await new Promise(((t,a)=>{chrome.debugger.sendCommand({tabId:e},"Page.getFrameTree",{},(e=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),a(chrome.runtime.lastError)):t(e)}))}));return await g.detachDebugger(e),t},getDomSnapshot:async e=>{await g.attachDebugger(e),await g.enableRuntime(e);const t=await new Promise(((t,a)=>{chrome.debugger.sendCommand({tabId:e},"DOMSnapshot.captureSnapshot",{computedStyles:[],includeDOMRects:!0},(e=>{chrome.runtime.lastError&&a(chrome.runtime.lastError),t(e)}))}));return await g.detachDebugger(e),t},printToPDF:async(e,t)=>{await g.attachDebugger(e),await g.enableRuntime(e);const a=await new Promise(((a,n)=>{chrome.debugger.sendCommand({tabId:e},"Page.printToPDF",t,(e=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),n(chrome.runtime.lastError)):a(e.data)}))}));return await g.detachDebugger(e),a}};h||(chrome.debugger.onEvent.addListener((async(e,t,a)=>{var n,r;if(e.tabId!==g.tabId)return;if("Runtime.consoleAPICalled"!==t||"log"!==a.type||!(null==(n=a.args)?void 0:n.length))return;const i=(null==(r=a.args[0])?void 0:r.value)||"",s=a.executionContextId;if(i.includes("rpa_debugger_on")){const e=`${i.split(":")[1]}`;g.frameContextIdMap[e]||(g.frameContextIdMap[e]=[s]),g.frameContextIdMap[e].includes(s)||g.frameContextIdMap[e].push(s)}})),chrome.debugger.onDetach.addListener((()=>{g.attached=!1})));const w="jpeg";async function captureFullPage(e){let t;if("$firefox$"===u.getNavigatorUserAgent())return t=await function(e){return new Promise((t=>{chrome.tabs.sendMessage(e.id,{key:"fullPageRect",data:{}},{frameId:0},(a=>{browser.tabs.captureTab(e.id,{format:w,quality:92,rect:a}).then((e=>{t(e)}))}))}))}(e),t;await attach(e.id,null,e),await enablePage(e.id),await setBg(e.id,{color:{r:255,g:255,b:255,a:1}});const{cssContentSize:{width:a,height:n}}=await(r=e.id,new Promise((e=>{chrome.debugger.sendCommand({tabId:r},"Page.getLayoutMetrics",{},e)})));var r;return await function(e,{height:t,width:a}){return new Promise((n=>{chrome.debugger.sendCommand({tabId:e},"Emulation.setDeviceMetricsOverride",{height:t,width:a,deviceScaleFactor:1,mobile:!1},n)}))}(e.id,{height:n,width:a}),await sleep(500),t=await screenshot(e.id,{x:0,y:0,width:a,height:n}),await sleep(500),await clearSize(e.id),await detach(e.id),t}function clearSize(e){return new Promise((t=>{chrome.debugger.sendCommand({tabId:e},"Emulation.clearDeviceMetricsOverride",t)}))}function screenshot(e,t){return new Promise(((a,n)=>{chrome.debugger.sendCommand({tabId:e},"Page.captureScreenshot",{format:w,fromSurface:!0,quality:92,clip:{...t,scale:1}},(e=>{if(chrome.runtime.lastError)n(chrome.runtime.lastError);else{const t=`data:image/${w};base64,${e.data}`;a(t)}}))}))}function setBg(e,t){return new Promise((a=>{chrome.debugger.sendCommand({tabId:e},"Emulation.setDefaultBackgroundColorOverride",t,a)}))}function enablePage(e){return new Promise((t=>{chrome.debugger.sendCommand({tabId:e},"Page.enable",{},(()=>{t(e)}))}))}function attach(e,t,a){return new Promise(((t,n)=>{"complete"===a.status&&chrome.debugger.attach({tabId:e},"1.0",(()=>{chrome.runtime.lastError?n(chrome.runtime.lastError):t(a||{id:e})}))}))}function detach(e){return new Promise((t=>{chrome.debugger.detach({tabId:e},(()=>{setTimeout((()=>{t(e)}),3e3)}))}))}function sleep(e){return new Promise((t=>setTimeout(t,e)))}async function captureArea(e,t){const a=await function(e){return new Promise((t=>{chrome.tabs.sendMessage(e.id,{key:"getDPR",data:{}},{frameId:0},(e=>{"number"==typeof e.dpr?t(e.dpr):t(1)}))}))}(e);t={x:t.x/a,y:t.y/a,width:t.width/a,height:t.height/a},await attach(e.id,0,e),await enablePage(e.id),await setBg(e.id,{color:{r:255,g:255,b:255,a:1}}),await sleep(3e3);const n=await screenshot(e.id,t);return await clearSize(e.id),await detach(e.id),await sleep(1e3),n}const f="$firefox$"===u.getNavigatorUserAgent(),_={query:e=>new Promise((t=>{chrome.tabs.query(e,(e=>{t(e)}))})),create:e=>(e.url||(e.url="about:blank"),new Promise((t=>{chrome.tabs.create(e,(e=>{t(e)}))}))),update:(e,t)=>new Promise((a=>{chrome.tabs.update(e,t,(e=>{a(e)}))})),get:e=>new Promise((t=>{chrome.tabs.get(e,(e=>{t(e)}))})),reload:()=>new Promise((e=>{_.getActiveTab().then((t=>{chrome.tabs.reload(t.id,{bypassCache:!0},(()=>{e(!0)}))}))})),stopLoad:()=>new Promise((e=>{_.getActiveTab().then((t=>{_.sendTabMessage(t.id,{key:"stopLoad",data:{key:"stopLoad",data:{}}}).then((t=>{e(t)}))}))})),goForward:()=>new Promise((e=>{_.getActiveTab().then((t=>{chrome.tabs.goForward(t.id,(()=>{e(!0)}))}))})),goBack:()=>new Promise((e=>{_.getActiveTab().then((t=>{chrome.tabs.goBack(t.id,(()=>{e(!0)}))}))})),remove:e=>new Promise((t=>{chrome.tabs.remove(e,(()=>{t(!0)}))})),getZoom:e=>new Promise((t=>{chrome.tabs.getZoom(e,(e=>{t(e)}))})),executeFuncOnFrame:(e,t,a,n)=>new Promise(((r,i)=>{chrome.scripting.executeScript({target:{tabId:e,frameIds:[t]},func:a,args:n,world:"ISOLATED"},(e=>{if(chrome.runtime.lastError)return i(new Error(chrome.runtime.lastError.message));e&&null!==e[0]?Array.isArray(e)&&1===e.length?r(e[0].result):i(new Error(`unknown error: fail to execute script on ${t}`)):i(new Error(`${a.toString()}executeFuncOnFrame error on frameId${t}`))}))})),executeScriptOnFrame:(e,t,a)=>new Promise(((n,r)=>{g.evaluate(e,a,t).then((e=>{n(e)})).catch((t=>{g.detachDebugger(e),r(t)}))})),runJS:(e,t,a)=>new Promise(((n,r)=>{if(f)_.sendTabFrameMessage(e,a,t).then((e=>{e.code===o.SUCCESS?n(e.data):r(new Error(e.msg||l.EXECUTE_ERROR))})).catch((e=>{r(e)}));else{const{code:i}=a.data;_.executeScriptOnFrame(e,t,i).then((e=>{n(e)}),(e=>{r(e)}))}})),getAllTabs:()=>new Promise((e=>{chrome.tabs.query({},(t=>{e(t)}))})),reloadAllTabs:()=>{_.getAllTabs().then((e=>{for(const t of e)t.url&&!t.url.startsWith("chrome://")&&chrome.tabs.reload(t.id)}))},urlGetTab:e=>new Promise(((t,a)=>{chrome.tabs.query({},(n=>{const r=n.find((t=>u.isEndWithSlash(t.url)&&!u.isEndWithSlash(e)?t.url===`${e}/`:t.url===e));r?_.activeTargetTab(r.id).then((e=>{t(e)})):a(new Error("no tab found"))}))})),getTab:e=>new Promise(((t,a)=>{try{_.getActiveTab().then((a=>{a.url===e?t(a):_.urlGetTab(e).then((e=>{t(e)}),(()=>{_.openTab(e).then((e=>{t(e)}))}))}))}catch(n){a(n)}})),getActiveTab:()=>new Promise((e=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{e(t[0])}))})),activeTargetTab:e=>new Promise((t=>{chrome.tabs.update(e,{active:!0},(e=>{t(e)}))})),activeTargetTabByTabUrl:e=>new Promise((t=>{chrome.tabs.query({url:e},(a=>{a&&a[0]?chrome.tabs.update(a[0].id,{active:!0,highlighted:!0,selected:!0},(e=>{t(e)})):chrome.tabs.create({url:e},(e=>{t(e)}))}))})),switchTab:(e,t,a)=>new Promise((n=>{a?_.activeTargetTab(a).then((e=>{n(e)})):chrome.tabs.query({url:e,title:t},(e=>{e&&e[0]?_.activeTargetTab(e[0].id).then((e=>{n(e)})):n(null)}))})),openTab:e=>new Promise((t=>{chrome.tabs.create({url:e},(e=>{t(e)}))})),closeTab:e=>new Promise((t=>{chrome.tabs.remove(e,(()=>{t(!0)}))})),excuteTabScript:(e,t)=>new Promise((a=>{chrome.tabs.executeScript(e,{code:t},(e=>{a(e)}))})),getAllFrames:e=>new Promise((t=>{chrome.webNavigation.getAllFrames({tabId:e},(a=>{const n=a.filter((e=>u.isSupportProtocal(e.url))),r=n.map(((t,a)=>{const r=[{frameId:t.frameId}];return _.executeFuncOnFrame(e,t.frameId,(e=>window.handleSync({key:"getFrameInfo",data:e})),r).then((e=>{if(0!==t.frameId){const{iframeXpath:r}=e;n[a]={...t,iframeXpath:r}}else n[a]={...t,iframeXpath:""}}))}));Promise.all(r).then((()=>t(n)))}))})),getExtFrames:e=>new Promise((t=>{chrome.webNavigation.getAllFrames({tabId:e},(e=>{t(e)}))})),sendTabFrameMessage:(e,t,a)=>new Promise(((n,r)=>{const i=setTimeout((()=>{r(new Error(`Message timeout: frameId ${a} not responding`))}),1e4);try{chrome.tabs.sendMessage(e,t,{frameId:a},(e=>{clearTimeout(i),chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):n(e)}))}catch(s){clearTimeout(i),r(s)}})),sendTabMessage:(e,t)=>new Promise((a=>{chrome.tabs.sendMessage(e,t,{},(e=>{a(e)}))})),sendMessage:e=>new Promise((t=>{_.getAllTabs().then((a=>{a.forEach((a=>{chrome.tabs.sendMessage(a.id,e,{},(e=>{t(e)}))}))}))})),getFramePosition:(e,t,a)=>new Promise((n=>{_.sendTabFrameMessage(e,{key:"getFramePosition",data:{url:a}},t).then((e=>{n(e)}))})),getUrl:()=>new Promise((e=>{_.getActiveTab().then((t=>{e(t.url)}))})),getTitle:()=>new Promise((e=>{_.getActiveTab().then((t=>{e(t.title)}))})),captureScreen:()=>new Promise((e=>{_.getActiveTab().then((t=>{chrome.tabs.captureVisibleTab(t.windowId,{format:"jpeg",quality:80},(t=>{e(t)}))}))})),capturePage:async()=>new Promise((e=>{_.getActiveTab().then((t=>{captureFullPage(t).then((t=>{e(t)}))}))})),captureElement:async e=>new Promise((t=>{_.getActiveTab().then((a=>{captureArea(a,e).then((e=>{t(e)}))}))})),resetZoom:e=>new Promise((t=>{chrome.tabs.setZoom(e,1,(()=>{t(!0)}))})),getFrameTree:e=>g.getFrameTree(e),printPage:(e,t)=>g.printToPDF(e,{printBackground:!0,...t})};async function locatorFrameId(e,t=0,a){try{const n=await _.executeFuncOnFrame(e,t,(e=>window.handleSync({key:"findIframeId",data:e})),[a]);if(n)return n}catch{return null}}function getSimilarElement(e,t){if(!function(e,t){const{cssSelector:a,pathDirs:n}=e,{cssSelector:r,pathDirs:i}=t,s=a.split(">"),c=r.split(">");if(e.url!==t.url)return!1;if(s.length!==c.length)return!1;if(n.length!==i.length)return!1;if(n.length===i.length)for(let o=0;o<n.length;o++)if(n[o].tag!==i[o].tag)return!1;return!0}(e,t))return!1;const a=function(e,t){var a;if(e===t)return e;const n=e.split("/"),r=t.split("/");for(let s=0;s<n.length;s++)n[s]!==r[s]&&(n[s]=null==(a=n[s])?void 0:a.split("[")[0]);const i=n.join("/");return i}(e.xpath,t.xpath),n=function(e,t){if(e===t)return e;const a=e.split(">"),n=t.split(">");for(let r=0;r<a.length;r++)a[r]!==n[r]&&a[r].includes(":nth-child")&&(a[r]=a[r].split(":nth-child")[0]),a[r]!==n[r]&&a[r].includes(".")&&(a[r]=a[r].split(".")[0]),a[r]!==n[r]&&a[r].includes("#")&&(a[r]=a[r].split("#")[0]);return a.join(">")}(e.cssSelector,t.cssSelector),r=function(e,t){for(let a=e.length-1;a>=0;a--){const n=e[a],r=t[a];n.attrs.forEach((e=>{const t=r.attrs.find((t=>t.name===e.name));if(t){const a=t.type===e.type,n=String(e.value)===String(t.value)&&""!==e.value;e.checked=!(!n||!a)&&(t.checked&&e.checked),"innertext"!==t.name&&"text"!==t.name||(e.checked=!1,e.value="")}else e.value="",e.checked=!1}))}return e}(e.pathDirs,t.pathDirs);return{...e,xpath:a,cssSelector:n,pathDirs:r}}const WindowControl_getCurrent=()=>new Promise((e=>{chrome.windows.getCurrent(null,(t=>{e(t)}))})),WindowControl_update=(e,t)=>new Promise((a=>{chrome.windows.update(e,t,(e=>{a(e)}))}));async function getIframeElement(e,t){const a=await _.getActiveTab(),n=await _.getAllFrames(a.id),r=JSON.parse(JSON.stringify(t));let i=n.find((e=>e.frameId===t.frameId));const s=[];for(;i;)s.unshift(i.frameId),i=n.find((e=>e.frameId===i.parentFrameId));const c=await async function(e,t,a,n){const r=[];for(const i of t)try{const t=await _.executeFuncOnFrame(e.id,i,(e=>window.handleSync({key:"getIframeElement",data:e})),[a]);r.push(t);const{nextPos:n}=t;a.x=n.x,a.y=n.y}catch{return[n]}return r}(a,s,e,t);if(c.length>0){const e=c[c.length-1],a=e.xpath===t.xpath,n=e.url===t.url;return a&&n||(c[c.length-1]=r),c.forEach(((e,t)=>{r.iframeXpath=0===t?e.xpath:`${r.iframeXpath}/$iframe$${e.xpath}`,e.iframeContentRect&&(r.rect.x+=e.iframeContentRect.x,r.rect.y+=e.iframeContentRect.y)})),r.rect.left=r.rect.x,r.rect.top=r.rect.y,r.rect.right=r.rect.x+r.rect.width,r.rect.bottom=r.rect.y+r.rect.height,r.iframeXpath=r.iframeXpath.split("/$iframe$").slice(0,-1).join("/$iframe$"),r}return t}function adjustRectPosition(e,t){e.x+=t.x,e.y+=t.y,e.left=e.x,e.top=e.y,e.right=e.x+e.width,e.bottom=e.y+e.height}async function findTabAndFrame(e){const{url:t,iframeXpath:a,isFrame:n,tabUrl:r}=e.data;let i=await _.getActiveTab();if(!i&&(i=await _.activeTargetTabByTabUrl(r),!i||!u.isSupportProtocal(i.url)))throw new Error(l.ACTIVE_TAB_ERROR);if(n){const e=await async function(e,t,a){const n=await _.getAllFrames(e.id);let r=null;r=a?function(e,t){if(!t||!Array.isArray(e)||0===e.length)return null;const a=t.split("/$iframe$").map((e=>e.trim())).filter(Boolean);if(0===a.length)return null;const n=e.find((e=>0===e.frameId));if(!n)return null;let r=n;for(const i of a){const t=e.find((e=>e.iframeXpath===i&&e.parentFrameId===r.frameId));if(!t)return null;r=t}return r}(n,a):function(e,t){return e.find((e=>e.url.includes(t)))}(n,t);if(r)return r.frameId;{const e=await async function(e){const t=e.split("/$iframe$"),a=await _.getActiveTab();if(!a)throw new Error(l.ACTIVE_TAB_ERROR);let n=0;for(let r=0;r<t.length;r++){const e=await locatorFrameId(a.id,n,t[r]);if(!e||null==e.frameId)return null;n=e.frameId}return n}(a);return null!==e?e:Number.NaN}}(i,t,a);return{tab:i,frameId:e}}return{tab:i,frameId:0}}globalThis.activeElement=null;const E={tabsHandler:()=>({async reloadTab(){const e=await _.reload();return u.success(e)},async stopLoad(){const e=await _.stopLoad();return u.success(e)},async openNewTab(e){const t=await _.create(e.data);return u.success(t)},async closeTab(e){let t,{url:a,id:n}=e.data;if(n&&"number"!=typeof n){try{if(n=Number.parseInt(n,10),Number.isNaN(n))return u.fail(l.NUMBER_ID_ERROR)}catch{return u.fail(l.NUMBER_ID_ERROR)}return await _.remove(n),u.success(!0)}return a&&(t=await _.getTab(a)),t||(t=await _.getActiveTab()),t?(await _.remove(t.id),u.success(!0)):u.fail("tab not found")},async updateTab(e){const{url:t}=e.data,a=await _.getActiveTab();return a?(await _.update(a.id,{url:t}),u.success(!0)):u.fail("tab not found")},async activeTab(e){const{url:t}=e.data,a=await _.getTab(t);return await _.activeTargetTab(a.id),u.success(!0)},async getActiveTab(){const e=await _.getActiveTab();return e?u.success(e):u.fail(l.ACTIVE_TAB_ERROR)},async switchTab(e){let{url:t,title:a,id:n}=e.data;if(n&&"number"!=typeof n)try{if(n=Number.parseInt(n,10),Number.isNaN(n))return u.fail(l.NUMBER_ID_ERROR)}catch{return u.fail(l.NUMBER_ID_ERROR)}const r=await _.switchTab(t,a,n);return r?u.success(r):u.fail(l.TAB_GET_ERROR)},async getAllTabs(){const e=await _.getAllTabs();return u.success(e)},async backward(){const e=await _.goBack();return u.success(e)},async forward(){const e=await _.goForward();return u.success(e)},async maxWindow(){const e=await WindowControl_getCurrent();if(await WindowControl_update(e.id,{state:"maximized"}))return u.success(!0);const{lastError:t}=chrome.runtime;return t?u.fail(t.message,o.EXECUTE_ERROR):void 0},async minWindow(){const e=await WindowControl_getCurrent();if(await WindowControl_update(e.id,{state:"minimized"}))return u.success(!0);const{lastError:t}=chrome.runtime;return t?u.fail(t.message,o.EXECUTE_ERROR):void 0},async executeScriptOnFrame(e){const{url:t,code:a}=e.data,n=await _.getActiveTab();if(!n)return u.fail(l.ACTIVE_TAB_ERROR);const r=(await _.getAllFrames(n.id)).find((e=>e.url===t)),i=r?r.frameId:0,s=await _.executeScriptOnFrame(n.id,i,a);return u.success(s)},async getTitle(){const e=await _.getTitle();return u.success(e)},async getUrl(){const e=await _.getUrl();return u.success(e)},async captureScreen(){const e=await _.captureScreen();if(e)return u.success(e)},async capturePage(){const e=await _.capturePage();if(e)return u.success(e)},async loadComplete(){const{lastError:e}=chrome.runtime,t=await _.getActiveTab();return t?e?u.fail(e.message,o.EXECUTE_ERROR):"complete"===t.status?u.success(!0):u.success(!1):u.fail(l.ACTIVE_TAB_ERROR)},async getFrames(){const e=await _.getActiveTab();if(!e)return u.fail(l.ACTIVE_TAB_ERROR);return await _.getAllFrames(e.id)},async getExtFrames(){const e=await _.getActiveTab();if(!e)return u.fail(l.ACTIVE_TAB_ERROR);return await _.getExtFrames(e.id)},async resetZoom(){const e=await _.getActiveTab();if(!e)return u.fail(l.ACTIVE_TAB_ERROR);return await _.resetZoom(e.id)},async getTabId(){const e=await _.getActiveTab();return e?u.success(e.id):u.fail(l.ACTIVE_TAB_ERROR)},async getFrameTree(){const e=await _.getActiveTab();if(!e)return u.fail(l.ACTIVE_TAB_ERROR);const t=await _.getFrameTree(e.id);return u.success(t)},async printPage(e){const t=await _.getActiveTab();if(!t)return u.fail(l.ACTIVE_TAB_ERROR);const a=await _.printPage(t.id,e);return u.success(a)}}),elementHandler:()=>({async getElement(e){const t=globalThis.activeElement;if(t&&t.isFrame){const{x:a,y:n}=e.data;if(!a||!n)return u.success(t);const r=await getIframeElement({x:a,y:n},t);return u.success(r)}return u.success(t)},async getOuterHTML(e){try{const t=await E.elementHandler().getElement(e);e.data=(null==t?void 0:t.data)||globalThis.activeElement;const{tab:a,frameId:n}=await findTabAndFrame({...e}),r=await _.sendTabFrameMessage(a.id,e,n),i={...e.data,...r.data};return u.success(i)}catch(t){console.log("ignore getOuterHTML error: ",t);const e=globalThis.activeElement;return u.success(e)}},async handleInContent(e){const{tab:t,frameId:a}=await findTabAndFrame(e);if(Number.isNaN(a))return u.fail(l.FRAME_GET_ERROR,o.ELEMENT_NOT_FOUND);if(!u.isSupportProtocal(t.url))return u.fail(`${t.url} ${l.CURRENT_TAB_UNSUPPORT_ERROR}`);const n=await _.sendTabFrameMessage(t.id,e,a);return null===n?u.fail(l.CONTENT_MESSAGE_ERROR,o.UNKNOWN_ERROR):n.code!==o.SUCCESS?u.fail(n.msg,n.code):u.success(n.data)},async getElementPos(e){const{isFrame:t}=e.data,{tab:a,frameId:n}=await findTabAndFrame(e);if(!u.isSupportProtocal(a.url))return u.fail(`${a.url} ${l.CURRENT_TAB_UNSUPPORT_ERROR}`);if(!t){const t=await _.sendTabFrameMessage(a.id,e,n);return u.result(t.data,t.msg,t.code)}const r=await _.getAllFrames(a.id),i=r.find((e=>e.frameId===n));if(!i)return u.fail(l.FRAME_GET_ERROR,o.ELEMENT_NOT_FOUND);const s=function(e,t){const a=[];for(;t;)a.unshift(t),t=e.find((e=>e.frameId===t.parentFrameId));return a}(r,i),c=await async function(e,t){const a=t.slice(0,-1).map(((a,n)=>{const r=t[n+1],i=[{iframeXpath:r.iframeXpath,url:r.url}];return _.executeFuncOnFrame(e,a.frameId,(e=>window.handleSync({key:"getFramePosition",data:e})),i)}));return(await Promise.all(a)).reduce(((e,t)=>(e.x+=t.x,e.y+=t.y,e)),{x:0,y:0})}(a.id,s),d=await _.sendTabFrameMessage(a.id,e,i.frameId);return d.code!==o.SUCCESS?u.fail(d.msg,d.code):(function(e,t){Array.isArray(e)?e.forEach((e=>adjustRectPosition(e,t))):adjustRectPosition(e,t)}(d.data.rect,c),u.success(d.data))},checkElement:async e=>await E.elementHandler().getElementPos(e),async scrollIntoView(e){var t;if(null==(t=e.data)?void 0:t.openSourcePage){const t=await _.getActiveTab();t&&t.url===e.data.tabUrl||await _.openTab(e.data.url)}return await E.elementHandler().handleInContent(e)},async similarElement(e){var t;let a=globalThis.activeElement;const{tabUrl:n}=e.data;let r=await _.getActiveTab();if(!r)return u.fail(l.ACTIVE_TAB_ERROR);r.url!==n&&(r=await _.getTab(n));try{if(!function(e,t){if(!e||!t)return!1;if(0===e.length||0===t.length)return!1;const a=e[0],n=t[0],r=a.attrs.find((e=>"id"===e.name&&e.checked&&""!==e.value)),i=n.attrs.find((e=>"id"===e.name&&e.checked&&""!==e.value));return r&&i?r.value===i.value:!r&&!i}(e.data.pathDirs,a.pathDirs)){const t=await E.elementHandler().handleInContent({...e,key:"reSimilarElement",data:{...a,preData:e.data}});log_info("reSimilarElement result: ",t),t.data&&(e.data=t.data.preData,a=t.data,delete e.data.preData)}const n=getSimilarElement(e.data,a);if(n){const a=await E.elementHandler().handleInContent({...e,data:n});return n.similarCount=(null==(t=a.data)?void 0:t.similarCount)||0,u.success(n)}return u.fail(l.NOT_SIMILAR_ELEMENT,o.ELEMENT_NOT_FOUND)}catch(i){return u.fail(i.toString(),o.EXECUTE_ERROR)}},elementFromSelect:async e=>await E.elementHandler().handleInContent(e),async elementIsRender(e){const{tab:t,frameId:a}=await findTabAndFrame(e);if(Number.isNaN(a))return u.success(!1);const n=await _.sendTabFrameMessage(t.id,e,a);return n?u.success(n.data):u.success(!1)},async elementIsReady(e){const t=await _.getActiveTab(),{tab:a,frameId:n}=await findTabAndFrame(e);if(Number.isNaN(n))return u.success(!1);const r=await _.sendTabFrameMessage(a.id,e,n),i="complete"===t.status;return r?u.success(r.data&&i):u.success(!1)},async elementIsTable(e){e.data.xpath||(e.data=globalThis.activeElement);const t={isTable:!!(await E.elementHandler().handleInContent(e)).data,...e.data};return u.success(t)},async tableDataBatch(e){var t;"xpath"in e.data||(e.data=globalThis.activeElement);const a=await E.elementHandler().handleInContent(e),n=(null==(t=a.data)?void 0:t.values)||[],r=new DataTable(a.data,n,"table").getTable();return u.success(r)},async tableColumnDataBatch(e){var t;"xpath"in e.data||(e.data=globalThis.activeElement);const a=await E.elementHandler().handleInContent(e),n=(null==(t=a.data)?void 0:t.value)||[],r=new DataTable(a.data,n,"similar").getTable();return u.success(r)},async similarBatch(e){var t;if("xpath"in e.data||(e.data=globalThis.activeElement),"batchType"in e.data&&["similar","similarAdd"].includes(e.data.batchType)){const t=await E.elementHandler().similarElement(e);if(t.code!==o.SUCCESS)return t;e.data=t.data}const a=await E.elementHandler().handleInContent(e),n=(null==(t=a.data)?void 0:t.value)||[],r=new DataTable(a.data,n,"similar").getTable();return u.success(r)},async tableHeaderBatch(e){"xpath"in e.data||(e.data=globalThis.activeElement);return await E.elementHandler().handleInContent(e)},simalarListBatch:async e=>await E.elementHandler().handleInContent(e),highLightColumn:async e=>await E.elementHandler().handleInContent(e),async getBatchData(e){var t;if(null==(t=e.data)?void 0:t.openSourcePage){const t=await _.getActiveTab();t&&t.url===e.data.tabUrl||await _.openTab(e.data.tabUrl)}if(await u.wait(3),e.data&&"similar"===e.data.produceType){e.key="simalarListBatch";return await E.elementHandler().simalarListBatch(e)}e.key="tableDataBatch";return await E.elementHandler().tableDataBatch(e)},async elementShot(e){var t;e.key="scrollToTop",await E.elementHandler().scrollToTop(e),await E.tabsHandler().resetZoom(),e.key="getElementPos";const a=await E.elementHandler().getElementPos(e),{x:n,y:r,width:i,height:s}=null==(t=a.data)?void 0:t.rect,c=await _.captureElement({x:n,y:r,width:i,height:s});return u.success(c)},async scrollToTop(e){const t=await E.elementHandler().handleInContent(e);return u.success(t)},async getSimilarIterator(e){var t,a;e.key="elementFromSelect";const n=(null==(t=e.data)?void 0:t.index)||0,r=(null==(a=e.data)?void 0:a.count)||1,i=await E.elementHandler().elementFromSelect(e);if(i.data&&Array.isArray(i.data)){if(n<i.data.length){let e=[i.data[n]];return e=n+r<=i.data.length?i.data.slice(n,n+r):i.data.slice(n),e=e.map(((e,t)=>(e.index+=t,{...e,similarCount:i.data.length}))),u.success(e)}return u.success([])}return u.fail(l.SIMILAR_NOT_FOUND,o.ELEMENT_NOT_FOUND)},async getRelativeElement(e){const{relativeOptions:t}=e.data;if(!t)return u.fail(l.RELATIVE_ELEMENT_PARAMS_ERROR);return await E.elementHandler().handleInContent(e)},async generateElement(e){const t=await _.getActiveTab();if(!t)return u.fail(l.ACTIVE_TAB_ERROR);return await _.sendTabFrameMessage(t.id,e,0)},getParentElement:async e=>await E.elementHandler().handleInContent(e),getChildElement:async e=>await E.elementHandler().handleInContent(e),clickElement:async e=>await E.elementHandler().handleInContent(e),inputElement:async e=>await E.elementHandler().handleInContent(e),getElementText:async e=>await E.elementHandler().handleInContent(e),getElementAttrs:async e=>await E.elementHandler().handleInContent(e),removeElementAttr:async e=>await E.elementHandler().handleInContent(e),setElementAttr:async e=>await E.elementHandler().handleInContent(e),getElementChecked:async e=>await E.elementHandler().handleInContent(e),setElementChecked:async e=>await E.elementHandler().handleInContent(e),getElementSelected:async e=>await E.elementHandler().handleInContent(e),setElementSelected:async e=>await E.elementHandler().handleInContent(e),getTableData:async e=>await E.elementHandler().handleInContent(e),scrollWindow:async e=>await E.elementHandler().handleInContent(e)}),jsHandler:()=>({async runJS(e){const{tab:t,frameId:a}=await findTabAndFrame(e);if(Number.isNaN(a))return u.fail(l.FRAME_GET_ERROR,o.ELEMENT_NOT_FOUND);0!==a&&await _.getAllFrames(t.id);try{const n=await _.runJS(t.id,a,e);return u.success(n)}catch(n){return u.fail(n.toString(),o.EXECUTE_ERROR)}}}),cookieHandler:()=>({...m}),otherHandler:()=>({currentExtension:()=>new Promise((e=>{chrome.management.getSelf((t=>{e(t)}))})),backgroundInject:()=>u.success(!0),contentInject:()=>u.success(!0)}),noHandler:()=>u.fail(l.UNSUPPORT_ERROR,o.VERSION_ERROR)};function reloadAllTabs(){new Promise((e=>{chrome.tabs.query({},(t=>{e(t)}))})).then((e=>{for(const t of e)chrome.tabs.reload(t.id)}))}function disableOldExtensions(){new Promise((e=>{chrome.management.getAll((t=>{e(t)}))})).then((e=>{e.forEach((e=>{s.includes(e.id)&&e.enabled&&chrome.management.setEnabled(e.id,!1)}))}))}chrome.runtime.onMessage.addListener(((e,t,a)=>(function(e,t,a){if("element"===e.type&&t.tab){const a={tabTitle:t.tab.title,tabUrl:t.tab.url,isFrame:0!==t.frameId,frameId:t.frameId};globalThis.activeElement={...e.data,...a}}"requestFrameId"===e.type&&t.tab&&a(t.frameId),"keepBackgroundAlive"===e.type&&t.tab&&a(!0),"contentLoaded"===e.type&&t.tab&&a(!0)}(e,t,a),!0))),chrome.runtime.onInstalled.addListener((()=>{reloadAllTabs(),disableOldExtensions(),chrome.alarms.create("weakAlarm",{delayInMinutes:1,periodInMinutes:1})})),chrome.runtime.onStartup.addListener((()=>{reloadAllTabs()})),chrome.management.onEnabled.addListener((e=>{e.id===chrome.runtime.id&&(reloadAllTabs(),disableOldExtensions(),chrome.alarms.create("weakAlarm",{delayInMinutes:1,periodInMinutes:1}))})),chrome.alarms.onAlarm.addListener((e=>{"weakAlarm"===e.name&&log_info("Alive alarm triggered")})),chrome.runtime.onConnect.addListener((e=>{"Astron-Service-Worker"===e.name&&log_info("Astron service worker port connected")})),async function(){const e=await createWsApp();e.start(),e.event("browser","",(t=>{const a=t.to_reply();(async function(e){const t="string"==typeof e?JSON.parse(e):e;c.includes(t.key)||(log_info(t.key,t),log_time(t.key));const a=await async function(e){let t=null;const{key:a}=e,n=E;try{return n[a]?(t=await n[a](e),t):n.tabsHandler()[a]?(t=await n.tabsHandler()[a](e),t):n.elementHandler()[a]?(e.data&&"produceType"in e.data&&"similar"===e.data.produceType&&(e.data={...e.data,...e.data.values[0]}),t=await n.elementHandler()[a](e),t):n.jsHandler()[a]?(t=await n.jsHandler()[a](e),t):n.cookieHandler()[a]?(t=await n.cookieHandler()[a](e.data),t):n.otherHandler()[a]?(t=await n.otherHandler()[a](e.data),t):(t=n.noHandler(),t)}catch(r){return r.toString().includes("connection")?u.fail(l.CONTEXT_NOT_FOUND,o.UNKNOWN_ERROR):u.fail(r.toString(),o.EXECUTE_ERROR)}}(t);c.includes(t.key)||(log_timeEnd(t.key),log_info(t.key,a));return a})(t).then((t=>{a.data=t,e.send(a)}))}))}();
