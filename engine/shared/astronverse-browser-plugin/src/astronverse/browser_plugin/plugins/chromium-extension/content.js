const e="2px solid red",t=3e3;var n=(e=>(e.SUCCESS="0000",e.UNKNOWN_ERROR="5001",e.ELEMENT_NOT_FOUND="5002",e.EXECUTE_ERROR="5003",e.VERSION_ERROR="5004",e))(n||{}),r=(e=>(e.ELEMENT_INFO_INCOMPLETE="元素信息不完整，无法定位元素",e.ELEMENT_NOT_FOUND="元素未找到",e.ELEMENT_MULTI_FOUND="找到多个元素，无法唯一定位",e.ELEMENT_NOT_INPUT="该元素不是原生输入元素",e.ELEMENT_NOT_CHECKED="元素无选中属性",e.ELEMENT_NOT_SELECT="该元素不是原生选框元素",e.UNSUPPORT_ERROR="暂不支持",e.ELEMENT_PARENT_NOT_FOUND="父元素未找到，请检查元素是否存在父元素",e.ELEMENT_CHILD_NOT_FOUND="子元素未找到，请检查元素是否存在子元素",e.ELEMENT_CHILD_ORIGIN_NOT_FOUND="元素原始信息originXpath不完整，无法唯一定位子元素",e.UPDATE_TIP="请更新插件至最新版本后重试",e))(r||{});const o=["svg","g","defs","symbol","use","image","switch","a","text","tspan","textPath","foreignObject","rect","circle","ellipse","line","polyline","polygon","path","animate","animateMotion","animateTransform","set","linearGradient","radialGradient","pattern","clipPath","mask","filter","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feGaussianBlur","feImage","feMerge","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","feDistantLight","fePointLight","feSpotLight","marker","view","metadata","title","desc"],a={html:"根元素",body:"主体元素",div:"块元素",span:"行元素",p:"段落",a:"链接",address:"地址",area:"热点区域",article:"文章",audio:"音频",b:"强调文本",button:"按钮",canvas:"画布",code:"代码块",col:"表格列",colgroup:"表格列组",datalist:"数据列表",details:"详细信息",dialog:"对话框",em:"强调元素",embed:"外部内容",footer:"页脚",form:"表单",frame:"嵌入文档",h1:"标题",h2:"标题",h3:"标题",h4:"标题",h5:"标题",h6:"标题",header:"页眉",hr:"主题分割",i:"术语文本",iframe:"嵌入文档",img:"图像",input:"输入",textarea:"输入域",label:"说明",li:"列表",main:"主体",mark:"突出文本",menu:"菜单",nav:"导航",ol:"有序列表",picture:"图像",progress:"进度条",select:"下拉框",summary:"摘要",table:"表格",tr:"表格行",td:"单元格",ul:"无序列表",video:"视频"},l={text:"输入框",password:"密码",checkbox:"复选框",radio:"单选框",submit:"提交按钮",reset:"重置",button:"按钮",file:"文件",hidden:"隐藏",image:"图像",email:"电子邮件",url:"网址",tel:"电话号码",number:"数字",search:"搜索",range:"范围",date:"日期",time:"时间",month:"月份",week:"周",datetime:"日期和时间",color:"颜色"},i={removeUrlParams:e=>e.replace(/\?.*$/,""),isNumberStartString:e=>/^\d/.test(e),isNumberString:e=>/\d/.test(e),isSpecialCharacter(e){return!!this.isNumberStartString(e)||!!/[·~`!@#$%^&*()+={}\\[\]|:;"'<>,.?/（）￥！、；：“”‘’【】《》，。？—]/.test(e)},isSupportUrl:e=>/^(http|https|ftp|file):\/\/.+$/.test(e),getTag(e){const t=e.tagName.toLowerCase();if("input"===t){const t=e.getAttribute("type");return l[t]?l[t]:"输入框"}return a[t]?a[t]:"其他元素"},isDynamicAttribute(e,t){const n=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,r=/^[\w-]{20,}$/,o=["temp-","dynamic-","random-","unique-","session-","token-","uuid-","id-","key-","rand-","hover-","active-","focus-","selected-","-open","-active","-hover","-focus","-selected","show","hide","hidden"],a=t.toLowerCase();return"id"===e&&(n.test(t)||r.test(t))||o.some((e=>a.includes(e)))},isControlCharacter:e=>/[\x00-\x1F\x7F]/.test(e),isEffectCharacter:e=>/[0-9a-z\u4E00-\u9FA5]/i.test(e),isSpaceCharacter:e=>/^\s.*|\s$/.test(e),pureText:e=>(e.replaceAll(/[\x00-\x1F\x7F]/g,""),e.startsWith(" ")&&(e=e.replace(/^\s+/,"")),e.endsWith(" ")&&(e=e.replace(/\s+$/,"")),e),generateColumnNames(e){let t="";for(;e>0;){const n=(e-1)%26;t=String.fromCharCode(65+n)+t,e=Math.floor((e-1)/26)}return t},generateColor(e){const t=["#FF5733","#33FF57","#3357FF","#FF33A1","#A133FF","#33FFF5","#F5FF33","#FF3333","#33FFA1","#8A33FF"];return t[e%t.length]},generateRandomColor:()=>`rgb(${Math.floor(256*Math.random())},${Math.floor(151*Math.random())+50},${Math.floor(256*Math.random())})`,pureObject(e,t=[]){for(const n in e)t.includes(n)||delete e[n];return e},success:(e,t="success")=>({code:n.SUCCESS,data:e,msg:t}),fail:(e="failed",t=n.UNKNOWN_ERROR)=>({data:null,code:t,msg:e}),result:(e,t="success",r=n.SUCCESS)=>({code:r,data:e,msg:t})};function getSupportTag(e){return i.isSpecialCharacter(e)?"*":e}function getText(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName?e.value||e.getAttribute("placeholder")||"":"IMG"===e.tagName?e.getAttribute("alt")||"":e.textContent||e.innerText||""}function getNodeText(e){return Array.from(e.childNodes).filter((e=>e.nodeType===Node.TEXT_NODE&&e.textContent&&e.textContent.trim())).map((e=>e.textContent.replace(/[\x00-\x1F\x7F]/g,"").trim())).find((e=>e.length>0))||""}function textAttrFromElement(e){const t=getText(e).replace(/[\x00-\x1F\x7F]/g,""),n={text:t,attrs:{src:getAttr(e,"src"),href:getAttr(e,"href"),text:t}};for(const r in n.attrs)n.attrs[r]||delete n.attrs[r];return n}function getAttr(e,t){const n={accept:e.getAttribute("accept"),id:e.getAttribute("id"),class:e.getAttribute("class"),name:e.getAttribute("name"),type:e.getAttribute("type"),value:e.value,href:e.href,src:e.src,title:e.title,text:getNodeText(e),placeholder:e.placeholder,dataset:JSON.parse(JSON.stringify(e.dataset)),readonly:String(e.readOnly),role:e.getAttribute("role"),"aria-label":e.getAttribute("aria-label")};return t in n?n[t]||"":e.getAttribute(t)}function getElementIndex(e){return e.parentElement?Array.from(e.parentElement.children).filter((t=>t.tagName.toLowerCase()===e.tagName.toLowerCase())).indexOf(e)+1:0}function getAllElementIndex(e){return e.parentElement?Array.from(e.parentElement.children).indexOf(e)+1:0}function getElementNthIndex(e){if(hasSameTypeSiblings(e))return e.parentElement?Array.from(e.parentElement.children).indexOf(e)+1:0}function hasSameTypeSiblings(e){return!!e.parentElement&&Array.from(e.parentElement.children).filter((t=>t.tagName.toLowerCase()===e.tagName.toLowerCase())).length>1}function hasSiblings(e){return!!e.parentElement&&Array.from(e.parentElement.children).length>1}function hasSameClassSiblings(e,t){const n=e.parentElement?Array.from(e.parentElement.children).filter((t=>t!==e)):[];if(n&&n.length>0){return n.some((e=>e.classList.contains(t)))}return!1}function pickClass(e){const t=Array.from(e.classList);for(const n of t)if(!hasSameClassSiblings(e,n))return n;return""}function elementFromPoint(e,t,n){return n.elementFromPoint(e,t)}function isUniqueIdFn(e){return e&&!i.isSpecialCharacter(e)&&1===document.querySelectorAll(`#${e}`).length}function isSvgElement(e){return"http://www.w3.org/2000/svg"===e.namespaceURI}function getXpath(e,t=!1){if(!e)return"";let n="";for(;e;){const r=e.id,o=isUniqueIdFn(r);let a=getSupportTag(e.tagName.toLowerCase()),l=getElementIndex(e),i=hasSameTypeSiblings(e);const s=isSvgElement(e);if(a=s?"*":a,l=s?getAllElementIndex(e):l,i=s?hasSiblings(e):i,!t&&o){n=`//${a}[@id="${r}"]${n}`;break}if(n=l>0&&i?`/${a}[${l}]${n}`:`/${a}${n}`,(e=e.parentElement)&&"body"===e.tagName.toLowerCase()){n=`/${n}`;break}}return n}function getNthCssSelector(e,t=!1){if(!e)return"";const n=[];for(;e;){const r=getAttr(e,"id"),o=getSupportTag(e.tagName.toLowerCase()),a=isUniqueIdFn(r),l=getElementNthIndex(e),i=hasSameTypeSiblings(e),s=pickClass(e);if("html"===o){n.unshift(o);break}if(!t&&a){n.unshift(`#${r}`);break}if(i?s?n.unshift(`${o}.${s}`):n.unshift(`${o}:nth-child(${l})`):n.unshift(o),(e=e.parentElement)&&"body"===e.tagName.toLowerCase())return n.join(">")}return n.join(">")}function getElementsByXpath(e,t=!1){if(!e)return null;t&&(e=e.split("/").map((e=>{const t=e.match(/\[@position\(\)=\d+\]/);if(e.includes("@position")&&!t){const t=e.match(/@position\(\)=\d+/);if(t){const n=t[0].split("=")[1];return e.replace(/\[.*\]/,`[@position()=${n}]`)}}return e})).join("/")),(e.includes("/svg[")||e.includes("/svg/"))&&(e=function(e){return e.split("/").map((e=>{if(!e||"*"===e)return e;const t=e.match(/^([^[]+)/),n=t?t[1]:"",r=e.match(/\[(.+)\]/),a=r?r[1]:"";if(n&&"*"!==n){if(o&&o.includes(n)){if(a){const e=a.match(/^position\(\)\s*=\s*(\d+)$/);return e?`*[local-name()="${n}" and position()=${e[1]}]`:`*[local-name()="${n}" and ${a}]`}return`*[local-name()="${n}"]`}return e}return e})).filter(Boolean).join("/")}(e));const n=document.evaluate(e,document,null,XPathResult.ANY_TYPE,null);let r=n.iterateNext();const a=[];for(;r;)a.push(r),r=n.iterateNext();return a.length>0?a:null}function getElementByXPath(e){return e?document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue:null}function getElementBySelector(e,t=!1){if(!e)return null;if(t&&(e=function(e){const t=e.split(">").map((e=>e.includes(":nth-child")?e.substring(0,e.indexOf(":nth-child")+13):e.includes(".")?e.split(".")[0]:e)).join(">");return t}(e)),e.includes("$shadow$")){const t=function(e){const t=e.split(">$shadow$>");return queryDeepShadow(t)}(e);return t.length>0?t:null}{const t=Array.from(document.querySelectorAll(e));return t.length>0?t:null}}function queryDeepShadow(e,t=[document]){if(0===e.length)return[];const n=e[0],r=e.slice(1),o=0===r.length,a=[];for(const l of t){const e=l.querySelectorAll(n);if(0!==e.length)if(o)a.push(...e);else for(const t of e)if(t.shadowRoot){const e=queryDeepShadow(r,[t.shadowRoot]);a.push(...e)}}return a}function rebuildDirectory(e,t){for(let n=t.length-1;n>=0;n--){const r=t[n];r.attrs.find((e=>"id"===e.name&&e.checked))&&r.attrs.forEach((e=>{e.checked="id"===e.name}));const o=r.attrs.find((e=>"index"===e.name));if(o&&o.checked){o.checked=!1;const n=getElementsByXpath(generateXPath(t));n&&1===n.length&&n[0]===e||(o.checked=!0)}}return t}function getElementDirectory(e,t=!1){if(!e)return[];const n=e,r=[];for(;e;){const a=getAttr(e,"id"),l=pickClass(e),s=getAttr(e,"type"),c=getNodeText(e);let u=getSupportTag(e.tagName.toLowerCase()),d=getElementIndex(e),m=hasSameTypeSiblings(e);const h=isSvgElement(e),f=isUniqueIdFn(a);u=h?"*":u,d=h?getAllElementIndex(e):d,m=h?hasSiblings(e):m;const g=[];if(f&&g.push({name:"id",value:a,checked:!0,type:0}),h&&g.push({name:"local-name",value:e.tagName.toLowerCase(),checked:!0,type:0}),m&&d&&g.push({name:"index",value:d,checked:!0,type:0}),s&&g.push({name:"type",value:s,checked:!0,type:0}),l){const e=(o=l)&&!i.isSpecialCharacter(o)&&!i.isDynamicAttribute("class",o);g.push({name:"class",value:l,checked:e,type:1})}if(c&&c.length<64){const e=c.length<10&&i.isEffectCharacter(c)&&!i.isControlCharacter(c);g.push({name:"text",value:c,checked:e,type:1})}const E=e.attributes,p=["id","class","type","text","index","local-name"];for(const e in E)if("object"==typeof E[e]){const t=E[e].name,n=E[e].value;t&&n&&!p.includes(t)&&g.push({name:t,value:n,checked:!1,type:0})}const y={tag:u,checked:!0,value:u,attrs:g};if(r.unshift(y),a&&f&&!t)return rebuildDirectory(n,r);if((e=e.parentElement)&&"body"===e.tagName.toLowerCase())return rebuildDirectory(n,r)}var o;return rebuildDirectory(n,r)}function directoryXpath(e){return generateXPath(getElementDirectory(e))}function directoryFindElement(e,t=!1){let n=[];return n=getElementsByXpath(generateXPath(e,t),t),n&&n.length>0?(n=function(e,t){const n=t.filter((e=>e.checked));return e.filter((e=>{const t=[];let r=e,o=n.length,a=!0;for(;o>0;)t.unshift(r),r=r.parentElement,o--;return n.forEach(((e,n)=>{const r=e.attrs.find((e=>2===e.type&&e.checked));if(r){const e=String(r.value).trim();if(e){const l=t[n];if(l){const t=getAttr(l,r.name);try{new RegExp(e).test(t)||(a=!1)}catch(o){console.error(`Invalid regular expression: ${e}`,o),a=!1}}}}})),a}))}(n,e),n):null}function textfn(e){return e.includes('"')?`text()=concat(${e.split('"').map(((e,t,n)=>t<n.length-1?`"${e}", '"', `:`"${e}"`)).join("")})`:`text()="${e}"`}function generateXPath(e,t=!1){if(e&&0===e.length)return"";t&&(e=JSON.parse(JSON.stringify(e))).forEach((e=>{e.attrs.forEach((e=>{const t=`${e.value}`.trim();"index"===e.name&&""!==t||"id"===e.name&&""!==t?e.checked=!0:e.checked=!1}))}));const n=e.filter((e=>e.checked)).map((e=>{const t=e.attrs.filter((e=>(2!==e.type||!e.value||!e.checked)&&e.checked)).map((e=>{const t=function(e){let t;if(e.value=`${e.value}`,e.checked&&e.value)switch(e.name){case"index":t=`position()=${e.value}`;break;case"innertext":case"text":t=1===e.type?`contains(., "${e.value}")`:textfn(e.value);break;case"local-name":t=`local-name()="${e.value}"`;break;default:t=1===e.type?`contains(@${e.name}, "${e.value}")`:`@${e.name}="${e.value}"`}return t}(e);return t})).join(" and ");return t?`${e.tag}[${t}]`:e.tag})).join("/");return n.startsWith("html")?`/${n}`:`//${n}`}function getAllElementsPositionInBody(e=document.body){const t=Array.from(e.querySelectorAll("*")),n=Array.from(t).filter((e=>"head"!==e.tagName.toLowerCase()&&"title"!==e.tagName.toLowerCase()&&"meta"!==e.tagName.toLowerCase()&&"script"!==e.tagName.toLowerCase()&&"style"!==e.tagName.toLowerCase()&&"link"!==e.tagName.toLowerCase()&&"none"!==(null==e?void 0:e.style.display)&&"hidden"!==(null==e?void 0:e.style.visibility))).filter((e=>e.getBoundingClientRect().width>0&&e.getBoundingClientRect().height>0)),r=[];let o=[];return n.forEach((e=>{const t=e.getBoundingClientRect();if(e&&e.shadowRoot){const t=e.shadowRoot;o=getAllElementsPositionInBody(t)}r.push({element:e,...t.toJSON()})})),r.push(...o),r}function getAllFrames(){const e=document.querySelectorAll("iframe")||[],t=document.querySelectorAll("frame")||[];return Array.from(e).concat(Array.from(t))}function getWindowFrames(){const e=getAllFrames();return Array.from(e).map((e=>({xpath:directoryXpath(e),src:e.src,rect:getFrameContentRect(e)})))}function getClosestElementByPoint(e){const t=elementFromPoint(e.x,e.y,document),n=document.elementsFromPoint?(r=e.x,o=e.y,document.elementsFromPoint(r,o).map((e=>{const t=e.getBoundingClientRect();return{element:e,...t.toJSON()}}))):getAllElementsPositionInBody();var r,o;if(!n.length)return t;const a=n.filter((t=>t.left<=e.x&&t.top<=e.y&&t.right>=e.x&&t.bottom>=e.y));if(!a.length)return t;return a.reduce(((t,n)=>Math.hypot(t.left-e.x,t.top-e.y,t.right-e.x,t.bottom-e.y)<=Math.hypot(n.left-e.x,n.top-e.y,n.right-e.x,n.bottom-e.y)?t:n)).element}function findElementByPoint(e,t=!1,n=document){let r=elementFromPoint(e.x,e.y,n);return t&&n instanceof Document&&(r=getClosestElementByPoint(e)),r||null}function shadowRootElement(e,t,n="",r=[]){const{x:o,y:a}=e,l=t.elementFromPoint(o,a);if(l&&l.shadowRoot){const t=`:nth-child(${function(e){if(e.parentNode)return Array.from(e.parentNode.children).indexOf(e)+1}(l)})`;return n=n?`${n}>$shadow$>${getNthCssSelector(l)}${t}`:`${getNthCssSelector(l)}${t}`,r=r.concat(getElementDirectory(l)),shadowRootElement(e,l.shadowRoot,n,r)}return{element:l,path:n,dirs:r}}function getBoundingClientRect(e){const t=window.currentFrameInfo.iframeTransform,{scaleX:n=1,scaleY:r=1}=t,o=e.getBoundingClientRect().toJSON(),a=window.devicePixelRatio,{left:l,top:i,width:s,height:c,right:u,bottom:d,x:m,y:h}=o;return{left:Math.round(l*n*a),top:Math.round(i*r*a),width:Math.round(s*n*a)||8,height:Math.round(c*r*a)||8,right:Math.round(u*n*a),bottom:Math.round(d*r*a),x:Math.round(m*n*a),y:Math.round(h*r*a)}}function getFrameContentRect(e){const t=getBoundingClientRect(e),n=function(e){const t=window.devicePixelRatio,n=window.getComputedStyle(e);return{paddingLeft:(Number.parseInt(n.paddingLeft)||0)*t,paddingTop:(Number.parseInt(n.paddingTop)||0)*t,paddingRight:(Number.parseInt(n.paddingRight)||0)*t,paddingBottom:(Number.parseInt(n.paddingBottom)||0)*t}}(e),r=function(e){const t=window.devicePixelRatio,n=window.getComputedStyle(e);return{borderLeft:(Number.parseInt(n.borderLeftWidth)||0)*t,borderTop:(Number.parseInt(n.borderTopWidth)||0)*t,borderRight:(Number.parseInt(n.borderRightWidth)||0)*t,borderBottom:(Number.parseInt(n.borderBottomWidth)||0)*t}}(e);return{left:t.left+n.paddingLeft+r.borderLeft,top:t.top+n.paddingTop+r.borderTop,width:t.width-n.paddingLeft-n.paddingRight-r.borderLeft-r.borderRight,height:t.height-n.paddingTop-n.paddingBottom-r.borderTop-r.borderBottom,right:t.right-n.paddingRight-r.borderRight,bottom:t.bottom-n.paddingBottom-r.borderBottom,x:t.x+n.paddingLeft+r.borderLeft,y:t.y+n.paddingTop+r.borderTop}}function getIframeTransform(e){const t=window.getComputedStyle(e),n=new DOMMatrix(t.transform);return{scaleX:n.a,scaleY:n.d}}function getElementByElementInfo(e){const{xpath:t,cssSelector:n,pathDirs:r,shadowRoot:o,checkType:a,matchTypes:l}=e,i=l&&l.includes("onlyPosition");if(o)return getElementBySelector(n,i);if("visualization"===a)return directoryFindElement(r,i);let s=getElementsByXpath(t,i);return s&&0!==s.length||(s=getElementBySelector(n,i)),s}function elementCountByXpath(e){const t=document.evaluate(`count(${e})`,document,null,XPathResult.NUMBER_TYPE,null);return t?t.numberValue:0}function elementCountByCssSelector(e){return getElementBySelector(e).length}function similarCssSelectorByCssSelector(e){let t="",n=0;const r=e.split(">");for(let o=r.length-1;o>=0;o--)if(r[o].includes(":nth-child")){const e=r[o].split(":")[0];let a=`${r.slice(0,o).join(">")}>${e}>${r.slice(o+1).join(">")}`;a=a.trim(),a=a.startsWith(">")?a.slice(1):a,a=a.endsWith(">")?a.slice(0,-1):a;const l=elementCountByCssSelector(a);l>=n&&(n=l,t=a)}return t}function similarPathDirs(e){if(!e)return[];e.forEach((e=>{e.attrs.forEach(((e,t)=>{"id"===e.name&&0!==t&&(e.checked=!1),"text"!==e.name&&"innertext"!==e.name||(e.checked=!1)}))}));let t=0,n=JSON.parse(JSON.stringify(e));for(let r=e.length-1;r>=0;r--){const o=e[r].attrs.find((e=>"index"===e.name&&e.checked));if(o){const r=o.checked;o.checked=!1;const a=elementCountByXpath(generateXPath(e));a>t&&(t=a,n=JSON.parse(JSON.stringify(e))),o.checked=r}}return n}function similarDataBatch(e){const t=[],n={...e,value:t,value_type:e.value_type||"text"};n.rect&&delete n.rect,n.tag&&delete n.tag,n.text&&delete n.text;const r=getElementByElementInfo(e),o=r?Array.from(r):null;if(o){let e=null,r=0;for(;r<=o.length-1;){e=o[r],r+=1;const n=textAttrFromElement(e);t.push(n)}return t.every((e=>!e.text))&&(t.every((e=>e.attrs.src))&&(t.forEach((e=>{e.text=e.attrs.src})),n.value_type="src"),t.every((e=>e.attrs.href))&&(t.forEach((e=>{e.text=e.attrs.href})),n.value_type="href")),n.value=t,n}return n}function similarBatch(e){let{shadowRoot:t,xpath:n,cssSelector:r,pathDirs:o}=e;if(e.xpath.includes("table"))return tableColumnDataBatch(e);if(r=similarCssSelectorByCssSelector(e.cssSelector),t||(o=similarPathDirs(e.pathDirs),n=generateXPath(o)),!n){o=similarPathDirs(getElementDirectory(getElementByElementInfo(e)[0],!0)),n=generateXPath(o)}if(!r){r=similarCssSelectorByCssSelector(getNthCssSelector(getElementByElementInfo(e)[0],!0))}return similarDataBatch({...e,pathDirs:o,xpath:n,cssSelector:r})}function tableDataBatch(e){const t=getElementByElementInfo(e),n=function(e){const t=[];return e.thead.forEach(((n,r)=>{const o={title:n||i.generateColumnNames(r+1),value:[]};e.tbody.forEach((e=>{const t=e[r]?e[r]:"";o.value.push(t)})),t.push(o)})),t}(tableDataFormatterProcure(t?t[0]:null)),r={...e,values:n};return r.rect&&delete r.rect,r.tag&&delete r.tag,r.text&&delete r.text,r}function getTableMaxTr(e,t="tbody"){let n=null,r=0,o=e.querySelectorAll(`${t} > tr`);return o&&0!==(null==o?void 0:o.length)||"tbody"!==t||(o=e.querySelectorAll("tr")),Array.from(o).forEach((e=>{let t=0;e.querySelectorAll("th, td").forEach((e=>{const n=e.getAttribute("colspan");n?t+=Number(n):t++})),t>r&&(r=t,n=e)})),{maxNum:r,maxTr:n}}function getTableHead(e,t){if(!e||!e.cells||0===e.cells.length)return Array.from({length:t},(()=>""));return Array.from(e.cells).map((e=>(e.textContent||e.innerText||"").replace(/[\u0000-\u001F\u007F]/g,"")))}function tableDataFormatterProcure(e){const t=function(e){var t;let n=null,r=e;for(;!n&&r.parentElement;){if("table"===(null==(t=null==r?void 0:r.tagName)?void 0:t.toLowerCase())){n=r;break}r=r.parentElement}return n}(e),{maxNum:n}=getTableMaxTr(t,"tbody"),{maxTr:r,maxNum:o}=getTableMaxTr(t,"thead"),a=getTableHead(r,o);let l=t.querySelectorAll("tbody > tr");l&&0!==l.length||(l=t.querySelectorAll("tr"));let i=Array.from({length:l.length},(()=>Array.from({length:n},(()=>null))));l&&Array.from(l).forEach(((e,t)=>{let n=0;Array.from(e.cells).forEach((e=>{for(;null!==i[t][n];)n++;for(let r=0;r<e.rowSpan;r++)for(let o=0;o<e.colSpan;o++)i[t+r]&&(i[t+r][n+o]=(e.innerText||e.textContent||"").replace(/[\u0000-\u001F\u007F]/g,""));n+=e.colSpan}))})),i=i.map((e=>e.map((e=>("object"==typeof e&&(e=""),e)))));const s=i?i[0].length:a.length;return a.length<s&&a.push(...Array.from({length:s-a.length},(()=>""))),{thead:a,tbody:i}}function tableColumnDataBatch(e){const{cssSelector:t}=e,n=function(e){let t="";const n=e.split(">").filter((e=>"tbody"!==e&&"thead"!==e));return n.map((e=>{var t;if(e.includes("tr:nth-child(")){return"tr"}else if(e.includes("td:nth-child(")||e.includes("th:nth-child(")){const n=(t=e.match(/\d+/))==null?void 0:t[0];return`*:nth-child(${n})`}else{return e}})).forEach(((e,n)=>{t=0===n?e:e.includes("tr")?`${t} ${e}`:`${t}>${e}`})),t}(t),r=function(e){const{pathDirs:t}=e,n=function(e){const t=getElementByElementInfo(e),n=t?t[0]:null;if(!n)return-1;const r=n.closest("tr");let o=-1;return r&&Array.from(r.cells).forEach(((e,t)=>{e===n&&(o=t)})),o}(e);return t.map((e=>{const t={...e,attrs:e.attrs.map((e=>({...e})))};return"td"===e.tag||"th"===e.tag?(t.tag="*",t.value="*",t.attrs.forEach((e=>{"index"===e.name?(e.checked=!0,e.value=(n+1).toString()):e.checked=!1}))):"thead"===e.tag||"tbody"===e.tag?(t.tag="*",t.value="*",t.attrs.forEach((e=>{e.checked=!1}))):"tr"===e.tag?t.attrs.forEach((e=>{e.checked=!1})):t.attrs.forEach((e=>{"index"===e.name&&(e.checked=!0)})),t}))}(e),o=generateXPath(r);return similarDataBatch({...e,xpath:o,cssSelector:n,pathDirs:r})}function sendToBackground(e){return new Promise(((t,n)=>{if(function(){try{return!(!chrome.runtime||!chrome.runtime.id)}catch(e){return console.error("Error checking extension context:",e),!1}}())try{chrome.runtime.sendMessage(e,(e=>{t(e)}))}catch(r){n(r)}else t("Extension context is not valid")}))}const s={frameId:0,iframeXpath:"",iframeTransform:{scaleX:1,scaleY:1}};function postToIframe(e){var t;null==(t=e.contentWindow)||t.postMessage({key:"setCurrentWindowIframeInfo",data:{iframeXpath:directoryXpath(e),iframeTransform:getIframeTransform(e)}},"*")}function tagFrames(){getAllFrames().forEach((e=>{e.complete&&postToIframe(e),e.onload=()=>{postToIframe(e)},postToIframe(e)})),window.parent!==window&&(window.parent.postMessage({key:"getCurrentWindowIframeInfo"},"*"),window.parent.postMessage({key:"bindCurrentWindowIframeInfo",data:s},"*"))}function requestFrameId(){sendToBackground({type:"requestFrameId"}).then((e=>{s.frameId=e,0!==e&&window.parent.postMessage({key:"bindCurrentWindowIframeInfo",data:s},"*")}))}function listenMessage(e){const{key:t,data:n}=e.data;n&&"setCurrentWindowIframeInfo"===t&&(s.iframeXpath=n.iframeXpath,s.iframeTransform=n.iframeTransform),"getCurrentWindowIframeInfo"===t&&tagFrames(),n&&"bindCurrentWindowIframeInfo"===t&&function(e){const t=e.iframeXpath?getElementByXPath(e.iframeXpath):null;t&&(t.dataset.astronFrameId=String(e.frameId))}(n)}function loadIframe(){window.removeEventListener("message",listenMessage),window.addEventListener("message",listenMessage),requestFrameId(),tagFrames()}function findNodeByCssSelectorStepwise(e,t=!1){const n=e.split(">").map((e=>e.trim())).filter(Boolean);let r=document.querySelector("html"),o=null;for(let a=0;a<n.length;a++){let l=a+1;if("$shadow$"===n[a]&&(l+=1,l>n.length))return{found:!1,lastMatchedNode:r,lastMatchedStep:o,notFoundStep:e,notFoundIndex:a+1};const i=n.slice(0,l).join(">").trim();let s=null;try{s=getElementBySelector(i,t)}catch{return{found:!1,lastMatchedNode:r,lastMatchedStep:o,notFoundStep:i,notFoundIndex:a+1}}if(!s||0===s.length)return{found:!1,lastMatchedNode:r,lastMatchedStep:o,notFoundStep:i,notFoundIndex:a+1};r=s[0]??null,o=i}return{found:!0,lastMatchedNode:r,lastMatchedStep:o,notFoundStep:null}}function findNodeByXPathStepwise(e,t=!1){const n=e.split("/").filter((e=>""!==e.trim()));let r=document,o=null,a="";for(let l=0;l<n.length;l++){a+=0!==l||n[l].startsWith("html")?`/${n[l]}`:`//${n[l]}`;let e=null;try{e=getElementsByXpath(a,t)}catch{return{found:!1,lastMatchedNode:r,lastMatchedStep:o,notFoundStep:a,notFoundIndex:l+1}}const i=e&&e.length>0?e[0]:null;if(!i)return{found:!1,lastMatchedNode:r,lastMatchedStep:o,notFoundStep:a,notFoundIndex:l+1};r=i,o=a}return{found:!0,lastMatchedNode:r,lastMatchedStep:o,notFoundStep:null}}let c,u,d=0,m=!1;function findElement(e,t,n){const{clientX:r,clientY:o}=e;let a=findElementByPoint({x:r,y:o},m,t);a||(a=e.target);let l="",i=[];if(null==a?void 0:a.shadowRoot){const e=null==a?void 0:a.shadowRoot,n=shadowRootElement({x:r,y:o},e,getNthCssSelector(a));n&&(a=n.element,l=n.path,i=n.dirs),t=e}if(a){!function(e){sendToBackground({type:"element",data:e})}(formatElementInfo(a,t,l,i))}}function formatElementInfo(e,t,n="",r=[]){const o=getNthCssSelector(e),a=getElementDirectory(e),l=generateXPath(a),s=n?`${n}>$shadow$>${o}`:o,c=r.length>0?r.concat([{tag:"$shadow$",checked:!0,value:"$shadow$",attrs:[]}],a):a,u=i.getTag(e),d=i.pureText(getText(e)).substring(0,10),m=d?i.pureText(d):"unknown";return{matchTypes:[],checkType:"shadowRoot"in t?"customization":"visualization",xpath:l,cssSelector:s,pathDirs:c,rect:getBoundingClientRect(e),url:window.location.href,shadowRoot:t instanceof ShadowRoot,tag:u,text:m}}function elementNotFoundReason(e){const{checkType:t}=e;if(!e.cssSelector&&!e.xpath&&"customization"===t)return i.fail(r.ELEMENT_INFO_INCOMPLETE,n.ELEMENT_NOT_FOUND);if(e.pathDirs&&0===e.pathDirs.length&&"visualization"===t)return i.fail(r.ELEMENT_INFO_INCOMPLETE,n.ELEMENT_NOT_FOUND);let o="未找到元素";const a=function(e){const{xpath:t,cssSelector:n,checkType:r,shadowRoot:o,matchTypes:a}=e,l=a&&a.includes("onlyPosition");let i={found:!1,lastMatchedNode:null,lastMatchedStep:null,notFoundStep:null,notFoundIndex:0};if("customization"===r){if(o)return findNodeByCssSelectorStepwise(n,l);if(t)return findNodeByXPathStepwise(t,l);if(n)return findNodeByCssSelectorStepwise(n,l)}else i=findNodeByXPathStepwise(generateXPath(e.pathDirs),l);return i}(e);return a.found||(o=`元素在第${a.notFoundIndex}节点${a.notFoundStep}处发生变动`),i.fail(o,n.ELEMENT_NOT_FOUND)}function dispatchMouseSequence(e,t,n){const r={bubbles:!0,cancelable:!0,view:window,clientX:0,clientY:0};for(const o of t)queueMicrotask((()=>e.dispatchEvent(new MouseEvent(o,r))))}const h={ele:{getElement:async(e,t=!1,n=!1)=>{const{matchTypes:r,filterVisible:o=!1}=e,a=r&&r.includes("scrollPosition")&&!t&&!n;let l=getElementByElementInfo(e);var i;return!l&&a&&(l=await async function(e){const t=window.innerHeight;let n=1;for(;n<=20;){window.scrollTo(window.scrollX,n*t),await new Promise((e=>setTimeout(e,1500)));const r=getElementByElementInfo(e);if(r)return r;n++}return console.warn("Element lookup failed after maximum scroll attempts:",e),null}(e)),o&&l&&((i=l)&&i.length&&(i=i.filter((e=>{let t=e;for(;t&&"body"!==t.tagName.toLowerCase();){const e=window.getComputedStyle(t);if("none"===e.display||"hidden"===e.visibility||"collapse"===e.visibility)return!1;t=t.parentElement}return!0}))),l=i),l},getDom:async e=>{const t=await h.ele.getElement(e);return t?t[0]:null},getOuterHTML:async e=>{const t=await h.ele.getDom(e),n=t?t.outerHTML:"",r=getXpath(t,!0);return i.success({...e,abXpath:r,outerHTML:n,originXpath:r})},checkElement:async e=>{let t=null;try{t=await h.ele.getElement(e)}catch(r){return i.fail(r.toString(),n.EXECUTE_ERROR)}if(t&&1===t.length){const e=getBoundingClientRect(t[0]);return i.success({rect:[e]})}if(t&&t.length>1){const e=t.map((e=>getBoundingClientRect(e)));return i.success({rect:e})}return elementNotFoundReason(e)},getElementPos:async e=>{let t=null;try{t=await h.ele.getElement(e)}catch(r){return i.fail(r.toString(),n.EXECUTE_ERROR)}if(t&&t[0]){const e=getBoundingClientRect(t[0]);return i.success({rect:e})}return elementNotFoundReason(e)},scrollIntoView:async e=>{const{matchTypes:t,atomConfig:r}=e;let o;try{o=await h.ele.getDom(e)}catch(a){return i.fail(a.toString(),n.EXECUTE_ERROR)}if(o)return r&&!r.scrollIntoCenter?o.scrollIntoView(!1):o.scrollIntoView({behavior:"instant",block:"center"}),i.success(!0);t&&t.includes("scrollPosition");return elementNotFoundReason(e)},elementFromSelect:async e=>{const{domain:t=location.origin,url:r=location.href,shadowRoot:o}=e;let a=null;try{a=await h.ele.getElement(e)}catch(l){return i.fail(l.toString(),n.EXECUTE_ERROR)}if(a&&1===a.length){const n=formatElementInfo(a[0],document);return i.success([{...e,...n,domain:t,shadowRoot:o,url:r}])}if(a&&a.length>1){const n=a.map((n=>{const a=formatElementInfo(n,document);return{...e,...a,domain:t,shadowRoot:o,url:r}}));return i.success(n)}return elementNotFoundReason(e)},elementIsRender:async e=>{try{const t=await h.ele.getElement({...e,filterVisible:!0});return i.success(t&&t.length)}catch(t){return i.fail(t.toString(),n.EXECUTE_ERROR)}},elementIsReady:async e=>{try{const t=await h.ele.getElement(e);return i.success(t&&t.length)}catch(t){return i.fail(t.toString(),n.EXECUTE_ERROR)}},elementIsTable:async e=>{try{const n=await h.ele.getDom(e),r=!!n&&("table"===(t=n).tagName.toLowerCase()||null!==t.closest("table"));return i.success(r)}catch(r){return i.fail(r.toString(),n.EXECUTE_ERROR)}var t},similarBatch:e=>{try{const t=similarBatch(e);return i.success(t)}catch(t){return i.fail(t.toString(),n.EXECUTE_ERROR)}},tableDataBatch:e=>{try{const t=tableDataBatch(e);return i.success(t)}catch(t){return i.fail(t.toString(),n.EXECUTE_ERROR)}},tableColumnDataBatch:e=>{try{const t=tableColumnDataBatch(e);return i.success(t)}catch(t){return i.fail(t.toString(),n.EXECUTE_ERROR)}},tableHeaderBatch:e=>{try{const t=function(e){const t=getElementByElementInfo(e),n=t?t[0]:null;let r=[];const o=function(e){return e.closest("table")}(n);if(o){const{maxTr:e,maxNum:t}=getTableMaxTr(o,"thead");if(e&&(r=getTableHead(e,t)),!r.length){const e=n.closest("tr");r=getTableHead(e,e.cells.length)}}else{const{value:t}=similarBatch(e);t&&t.length&&(r=t.map((e=>{const{text:t=""}=e;return t})))}return r}(e);return i.success(t)}catch(t){return i.fail(t.toString(),n.EXECUTE_ERROR)}},simalarListBatch:e=>{try{const t=function(e){const{values:t}=e;return{values:t.map(((e,t)=>({...similarDataBatch(e),title:e.title||i.generateColumnNames(t+1)})))}}(e);return i.success(t)}catch(t){return i.fail(t.toString(),n.EXECUTE_ERROR)}},similarElement:async e=>{try{const t=await h.ele.getElement(e);return i.success({similarCount:t.length})}catch(t){return i.fail(t.toString(),n.EXECUTE_ERROR)}},reSimilarElement:async e=>{const t=await h.ele.getElement(e.preData),n=await h.ele.getElement(e);if(t&&n){const r=getNthCssSelector(t[0],!0),o=getElementDirectory(t[0],!0),a=generateXPath(o),l={...e.preData,pathDirs:o,xpath:a,cssSelector:r},s=getNthCssSelector(n[0],!0),c=getElementDirectory(n[0],!0),u=generateXPath(c),d={...e,pathDirs:c,xpath:u,cssSelector:s};return i.success({...d,preData:l})}return i.success(null)},highLightColumn:async n=>{if(d>0)return i.success({rect:[]});d=t;const{produceType:r,columnIndex:o}=n,a=i.generateColor(o?o-1:0);if("table"===r){const r=await h.ele.getElement(n);if(r&&r.length>0){const n=r[0].closest("table"),l=[],s=[],c=n.querySelector(`th:nth-child(${o})`),u=null==c?void 0:c.style.border;return c&&(c.style.border=e,c.style.borderColor=a,l.push(getBoundingClientRect(c))),n.querySelectorAll("tr").forEach((t=>{const n=t.querySelector(`td:nth-child(${o})`);if(n){const t=n.style.border;n.style.border=e,n.style.borderColor=a,s.push({border:t,td:n}),l.push(getBoundingClientRect(n))}})),setTimeout((()=>{d=0,c&&(c.style.border=u),s.forEach((({td:e,border:t})=>{e.style.border=t}))}),t),i.success({rect:l})}return d=0,elementNotFoundReason(n)}{const r=await h.ele.getElement(n);if(r&&r.length>0){const n=[],o=[];return r.forEach((t=>{const r=t.style.border;t.style.border=e,t.style.borderColor=a,o.push({border:r,ele:t}),n.push(getBoundingClientRect(t))})),setTimeout((()=>{d=0,o.forEach((e=>{e.ele.style.border=e.border}))}),t),i.success({rect:n})}return d=0,elementNotFoundReason(n)}},scrollToTop:()=>(window.scrollTo(0,0),!0),getRelativeElement:async e=>{let t;const o=null==e?void 0:e.relativeOptions;try{t=await h.ele.getElement(e)}catch(s){return i.fail(s.toString(),n.EXECUTE_ERROR)}if(!t)return elementNotFoundReason(e);if(t.length>1)return i.fail(r.ELEMENT_MULTI_FOUND,n.EXECUTE_ERROR);const{relativeType:a}=o;let l;try{if("child"===a&&(l=function(e,t){const{elementGetType:n,multiple:r}=t;if("index"===n)return e.children[t.index||0];if("all"===n)return Array.from(e.children);if("xpath"===n){if(r){const n=document.evaluate(`.${t.xpath}`,e,null,XPathResult.ANY_TYPE,null),r=[];let o=n.iterateNext();for(;o;)r.push(o),o=n.iterateNext();return r}return document.evaluate(`.${t.xpath}`,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}return"last"===n?e.lastElementChild:void 0}(t[0],o)),"parent"===a&&(l=t[0].parentElement),"sibling"===a&&(l=function(e,t){const{elementGetType:n}=t;return"all"===n?Array.from(e.parentElement.children):"prev"===n?e.previousElementSibling:"next"===n?e.nextElementSibling:void 0}(t[0],o)),Array.isArray(l)){const t=l.map((t=>{const n=formatElementInfo(t,document),r={...e,...n};return delete r.rect,delete r.text,delete r.relativeOptions,r}));return i.success(t)}if(l){const t=formatElementInfo(l,document),n={...e,...t};return delete n.rect,delete n.text,delete n.relativeOptions,i.success(n)}return elementNotFoundReason(e)}catch(s){return i.fail(s.toString(),n.EXECUTE_ERROR)}},generateElement:e=>{const{type:t,value:o,returnType:a}=e;let l;try{"xpath"===t&&(l=getElementsByXpath(o)),"cssSelector"===t&&(l=getElementBySelector(o)),"text"===t&&(l=getElementsByXpath(`//*[contains(text(),"${o}")]`))}catch(s){return i.fail(s.toString(),n.EXECUTE_ERROR)}if(l&&l.length>0){l=l.filter((e=>e.getBoundingClientRect().width>0&&e.getBoundingClientRect().height>0));const e=l.map((e=>{const t=formatElementInfo(e,document),n=i.pureObject(t,["xpath","cssSelector","url","shadowRoot"]);return Object.assign(n,{checkType:"customization",matchTypes:[]}),n}));return"list"===a?i.success(e):i.success(e[0])}return i.fail(r.ELEMENT_NOT_FOUND,n.ELEMENT_NOT_FOUND)},async getParentElement(e){const t=await h.ele.getDom(e),o=(null==t?void 0:t.parentElement)||null;if(o){const t=formatElementInfo(o,document),n={...e,...t,abXpath:getXpath(o,!0),outerHTML:o.outerHTML};return i.success(n)}return i.fail(r.ELEMENT_PARENT_NOT_FOUND,n.ELEMENT_NOT_FOUND)},async getChildElement(e){const{originXpath:t="",abXpath:o}=e;let a=null;if(!t)return i.fail(r.ELEMENT_CHILD_ORIGIN_NOT_FOUND,n.ELEMENT_NOT_FOUND);const l=t.split("/"),s=o.split("/"),c=await h.ele.getDom(e);if(l.length>s.length){if(a=getElementByXPath(l.slice(0,s.length+1).join("/")),a){const t=formatElementInfo(a,document),n={...e,...t,abXpath:getXpath(a,!0),outerHTML:a.outerHTML};return i.success(n)}return i.fail(r.ELEMENT_CHILD_NOT_FOUND,n.ELEMENT_NOT_FOUND)}if(l.length<=s.length){const t=Array.from(c.children);if(t.length>0){const o=t.find((e=>{const t=window.getComputedStyle(e);return"none"!==t.display&&"hidden"!==t.visibility&&e.getBoundingClientRect().width>0&&e.getBoundingClientRect().height>0}));if(o){a=o;const t=formatElementInfo(a,document),n={...e,...t,abXpath:getXpath(a,!0),outerHTML:a.outerHTML};return i.success(n)}return i.fail(r.ELEMENT_CHILD_NOT_FOUND,n.ELEMENT_NOT_FOUND)}return i.fail(r.ELEMENT_CHILD_NOT_FOUND,n.ELEMENT_NOT_FOUND)}},clickElement:async e=>{const t=await h.ele.getElement(e);if(t&&t.length>1)return i.fail(r.ELEMENT_MULTI_FOUND,n.EXECUTE_ERROR);const o=t?t[0]:null,{buttonType:a}=e.atomConfig;if(!o)return elementNotFoundReason(e);try{switch(a){case"right":dispatchMouseSequence(o,["mousedown","mouseup","contextmenu"]);break;case"dbclick":dispatchMouseSequence(o,["mousedown","mouseup","click","mousedown","mouseup","click","dblclick"]);break;default:dispatchMouseSequence(o,["mousedown","mouseup","click"])}}catch(l){return i.fail(`点击元素失败: ${l}`,n.EXECUTE_ERROR)}return i.success(!0)},inputElement:async e=>{const t=await h.ele.getElement(e);if(t&&t.length>1)return i.fail(r.ELEMENT_MULTI_FOUND,n.EXECUTE_ERROR);const o=t?t[0]:null,{inputText:a}=e.atomConfig;return o?"INPUT"!==o.tagName&&"TEXTAREA"!==o.tagName?i.fail(r.ELEMENT_NOT_INPUT,n.EXECUTE_ERROR):(o.value=a,i.success(!0)):elementNotFoundReason(e)},getElementText:async e=>{const t=await h.ele.getDom(e);if(t){if("INPUT"===t.tagName||"TEXTAREA"===t.tagName)return i.success(t.value);{const e=getText(t);return i.success(e)}}return elementNotFoundReason(e)},getElementAttrs:async e=>{const t=await h.ele.getDom(e),{operation:o,attrName:a}=e.atomConfig;if(t){let e=null;switch(o){case"0":e=getText(t);break;case"1":e=t.outerHTML;break;case"2":e=t.value||t.getAttribute("value");break;case"3":e=t.src||t.href||"";break;case"4":if(a)e=t.getAttribute(a)||"";else{const n={};for(let e=0;e<t.attributes.length;e++){const r=t.attributes[e];n[r.name]=r.value}e=n}break;case"5":e=getBoundingClientRect(t);break;case"6":if("INPUT"!==t.tagName)return i.fail(r.ELEMENT_NOT_CHECKED,n.EXECUTE_ERROR);e=t.checked;break;case"7":{const n=window.getComputedStyle(t);if(a){const r=a.includes("-")?a:a.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`));e=n.getPropertyValue(r)||t.style[a]||""}else{const t={};for(let e=0;e<n.length;e++){const r=n[e];t[r]=n.getPropertyValue(r)}e=t}break}default:return i.fail(r.UPDATE_TIP,n.EXECUTE_ERROR)}return i.success(e)}return elementNotFoundReason(e)},removeElementAttr:async e=>{const t=await h.ele.getDom(e),{attrName:n}=e.atomConfig;return t?(t.removeAttribute(n),i.success(!0)):elementNotFoundReason(e)},setElementAttr:async e=>{const t=await h.ele.getDom(e),{attrName:n,attrValue:r}=e.atomConfig;return t?(t.setAttribute(n,r),i.success(!0)):elementNotFoundReason(e)},getElementChecked:async e=>{const t=await h.ele.getDom(e);return t?"checkbox"===t.type||"radio"===t.type?i.success(t.checked):i.fail(r.ELEMENT_NOT_SELECT,n.EXECUTE_ERROR):elementNotFoundReason(e)},setElementChecked:async e=>{const t=await h.ele.getDom(e),{checked:o,reverse:a}=e.atomConfig;return t?"checkbox"===t.type||"radio"===t.type?(a?t.click():(t.checked!==o&&t.click(),t.checked=o),i.success(!0)):i.fail(r.ELEMENT_NOT_SELECT,n.EXECUTE_ERROR):elementNotFoundReason(e)},getElementSelected:async e=>{const t=await h.ele.getDom(e),{option:o}=e.atomConfig;if(t){if("SELECT"!==t.tagName)return i.fail(r.ELEMENT_NOT_SELECT,n.EXECUTE_ERROR);if("selected"===o){const e=Array.from(t.selectedOptions).map((e=>({label:e.label||"",value:e.value||""})));return i.success(e)}{const e=Array.from(t.options).map((e=>({label:e.label||"",value:e.value||""})));return i.success(e)}}return elementNotFoundReason(e)},setElementSelected:async e=>{const t=await h.ele.getDom(e),{value:o,pattern:a,indexValue:l}=e.atomConfig;if(t){if("SELECT"!==t.tagName)return i.fail(r.ELEMENT_NOT_SELECT,n.EXECUTE_ERROR);const e=t.options;for(let n=0;n<e.length;n++)"contains"===a&&e[n].label.includes(o)&&(t.value=e[n].value),"equal"===a&&e[n].label===o&&(t.value=e[n].value),"index"===a&&n+1===l&&(t.value=e[n].value);return t.dispatchEvent(new Event("change",{bubbles:!0})),i.success(!0)}return elementNotFoundReason(e)},getTableData:async e=>{const t=await h.ele.getDom(e);if(t){const e=tableDataFormatterProcure(t);return i.success(e)}return elementNotFoundReason(e)},scrollWindow:async e=>{let t=window;if((e.xpath||e.cssSelector||e.pathDirs)&&(t=await h.ele.getDom(e)),!t)return elementNotFoundReason(e);const{scrollTo:n,scrollAxis:r,scrollX:o=0,scrollY:a=0,scrollBehavior:l="instant"}=e.atomConfig;return"top"===n&&t.scrollTo({top:0,behavior:l}),"left"===n&&t.scrollTo({left:0,behavior:l}),"bottom"===n&&t.scrollTo({top:99999,behavior:l}),"right"===n&&t.scrollTo({left:99999,behavior:l}),"custom"===n&&"x"===r&&t.scrollTo({left:o,behavior:l}),"custom"===n&&"y"===r&&t.scrollTo({top:a,behavior:l}),i.success(!0)}},code:{runJS:e=>{try{const{code:t}=e,n=new Function(t)();return i.success(n)}catch(t){const e=`runJS ${t.toString()}`;return i.fail(e,n.EXECUTE_ERROR)}}},frame:{getFrames:()=>{const e=getWindowFrames();return i.success(e)},getFramePosition(e){const{url:t,iframeXpath:n}=e,r=getWindowFrames(),o=n?r.find((e=>e.xpath===n)):r.find((e=>e.src.includes(t)||t.includes(e.src)));return o?o.rect:{x:0,y:0,width:0,height:0,left:0,top:0,right:0,bottom:0}},getFrameInfo(e){const{frameId:t}=e;return console.log(`rpa_debugger_on:${t}`),s.frameId=t,tagFrames(),s},findIframeId(e){const t=getElementByXPath(e);if(t){const e=t.dataset.astronFrameId;return{frameId:e?Number(e):null}}return{frameId:null}},getIframeElement(e){const{x:t,y:n}=e,r=window.devicePixelRatio,o=t/r,a=n/r,l=document.elementFromPoint(o,a);if(l){const{left:e,top:t}=l.getBoundingClientRect(),n=Number.parseInt(window.getComputedStyle(l).borderLeftWidth),i=Number.parseInt(window.getComputedStyle(l).borderTopWidth),s=Number.parseInt(window.getComputedStyle(l).paddingLeft),c=Number.parseInt(window.getComputedStyle(l).paddingTop),u={x:(o-e-n-s)*r,y:(a-t-i-c)*r};let d=null;"IFRAME"!==l.tagName&&"FRAME"!==l.tagName||(d={x:(e+n+s)*r,y:(t+i+c)*r},tagFrames());return{...formatElementInfo(l,document),nextPos:u,iframeContentRect:d}}},stopLoad:()=>(window.stop(),!0)},page:{fullPageRect:()=>{const e="BackCompat"===document.compatMode?document.body:document.documentElement,t=Math.floor(8192/window.devicePixelRatio);return{x:0,y:0,width:Math.min(e.scrollWidth,t),height:Math.min(e.scrollHeight,t)}},getDPR:()=>({dpr:window.devicePixelRatio})}};function executeHandler(e,t,o=!0){try{return h.ele[e]?h.ele[e](t):h.code[e]?h.code[e](t):h.frame[e]?h.frame[e](t):h.page[e]?h.page[e](t):i.fail(r.UNSUPPORT_ERROR)}catch(a){return i.fail(a.toString(),n.EXECUTE_ERROR)}}async function handle(e){const{key:t,data:n}=e;return await executeHandler(t,n,!0)}loadIframe(),function keepServiceWorkerAlive(){chrome.runtime.connect(chrome.runtime.id,{name:"Astron-Service-Worker"}).onDisconnect.addListener((()=>{sendToBackground({type:"keepServiceWorkerAlive"}).then((()=>{keepServiceWorkerAlive()}))}))}(),window.addEventListener("load",loadIframe),window.addEventListener("load",(function(){return sendToBackground({type:"contentLoaded"})})),window.handle=handle,window.handleSync=function(e){const{key:t,data:n}=e;return executeHandler(t,n,!1)},window.RpaExtGetElement=function(e){try{const t=getElementByElementInfo(e);return t?t[0]:null}catch(t){throw new Error(t.toString())}},window.currentFrameInfo=s,chrome.runtime.onMessage.addListener(((e,t,n)=>((async()=>{try{return await handle(e)}catch(t){return{error:t.message}}})().then(n),!0))),window.addEventListener("mousemove",(e=>{var t,n;t=e,n=document,c&&clearTimeout(c),u&&clearTimeout(u),c=setTimeout((()=>{findElement(t,n),clearTimeout(c),u=setTimeout((()=>{m=!0,findElement(t,n),m=!1,clearTimeout(u)}),5e3)}),200)}),!0);
